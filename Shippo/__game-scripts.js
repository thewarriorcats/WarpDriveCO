var Ship=pc.createScript("ship");Ship.attributes.add("directionEntity",{type:"entity"}),Ship.attributes.add("originEntity",{type:"entity"}),Ship.attributes.add("centerEntity",{type:"entity"}),Ship.attributes.add("speed",{type:"number",default:1}),Ship.attributes.add("turnSpeed",{type:"number",default:.1}),Ship.attributes.add("cannonEntity",{type:"entity"}),Ship.attributes.add("modelEntity",{type:"entity"}),Ship.attributes.add("characterEntity",{type:"entity"}),Ship.attributes.add("damage",{type:"number",default:10}),Ship.prototype.initialize=function(){this.currentAngle=0,this.nextAngle=0,this.currentShootAngle=0,this.speedFactor=1,this.force=new pc.Vec3(0,0,0),this.entity.on("Ship:Direction",this.setDirection,this),this.entity.on("Ship:Steer",this.setSteer,this),this.entity.on("Ship:ShootDirection",this.setShootDirection,this),this.entity.on("Ship:Shoot",this.shoot,this),this.entity.on("Ship:Speed",this.setSpeed,this),this.entity.parent.on("Damage",this.onDamage,this),this.entity.parent.on("Death",this.onDeath,this),this.entity.parent.on("Respawn",this.onRespawn,this),this.entity.parent.on("Upgrade",this.onUpgrade,this),this.entity.parent.on("Level",this.setLevel,this),this.entity.parent.on("Flag",this.updateFlag,this),this.modelEntity.on("Model:Loaded",this.onModelLoaded,this),this.setLevelModel()},Ship.prototype.onModelLoaded=function(t){t&&this.updateFlag()},Ship.prototype.updateFlag=function(){this.setFlag(this.entity.parent.symbol0,this.entity.parent.symbol1,this.entity.parent.color0,this.entity.parent.color1)},Ship.prototype.setFlag=function(t,e,i,n){if(!t)return!1;if(!e)return!1;if(!i)return!1;if(!n)return!1;var o=this,s=this.app.assets.find("Symbol-"+t+".png"),r=this.app.assets.find("Symbol-"+e+".png");this.layerCount=0,this.modelEntity.fire("MaterialShader:Set","color_0",i.data),this.modelEntity.fire("MaterialShader:Set","color_1",n.data),s.ready((function(){o.layer0=s.resource,o.layerCount++,o.onFlagSet()})),r.ready((function(){o.layer1=r.resource,o.layerCount++,o.onFlagSet()})),this.app.assets.load(s),this.app.assets.load(r)},Ship.prototype.onFlagSet=function(){if(this.layerCount<2)return!1;this.modelEntity.fire("MaterialShader:Set","layer_0",this.layer0),this.modelEntity.fire("MaterialShader:Set","layer_1",this.layer1)},Ship.prototype.setLevel=function(t){this.entity.parent.level=t,this.setLevelModel()},Ship.prototype.setLevelModel=function(){var t=this,e=this.entity.parent.level;e||(e=0);var i=this.app.assets.find("Pirate-Ship-"+e+".glb");i.ready((function(){setTimeout((function(){t.modelEntity.fire("Model:Reload"),t.updateFlag()}),100)})),this.modelEntity.model.asset=i,this.app.assets.load(i);var n=this.entity.parent.findByName("Captain-Position-Level-"+e);n?this.characterEntity.setLocalPosition(n.getLocalPosition()):this.characterEntity.setLocalPosition(0,0,0),e>=6&&(this.centerEntity.findByName("Model").setLocalPosition(0,0,0),this.centerEntity.findByName("Mirror").setLocalPosition(0,-.8,0))},Ship.prototype.onUpgrade=function(){this.setLevelModel()},Ship.prototype.onRespawn=function(){this.centerEntity.fire("Motion","Loop")},Ship.prototype.onDeath=function(){this.centerEntity.fire("Motion","Death")},Ship.prototype.onDamage=function(){this.modelEntity.fire("Motion","Hit"),this.modelEntity.fire("MaterialShader:Play"),this.speedFactor=1.35},Ship.prototype.setSpeed=function(t){},Ship.prototype.setSteer=function(t){this.nextAngle=t},Ship.prototype.setDirection=function(t){this.currentAngle=t},Ship.prototype.setShootDirection=function(t){this.currentShootAngle=t},Ship.prototype.shoot=function(t,e,i){this.app.fire("ShootingManager:Shoot",this.entity.parent,t,e,i,this.damage),this.originEntity.fire("Motion","Shoot")},Ship.prototype.applyForce=function(t){if(!this.entity.parent.active)return!1;this.force.x=Math.sin(this.currentAngle)*this.speed*this.speedFactor*t,this.force.z=Math.cos(this.currentAngle)*this.speed*this.speedFactor*t,this.entity.parent.translate(this.force)},Ship.prototype.update=function(t){this.cannonEntity.setEulerAngles(0,this.currentShootAngle*pc.math.RAD_TO_DEG,0),this.speedFactor=pc.math.lerp(this.speedFactor,1,1*t),this.currentAngle=Utils.rotate(this.currentAngle,this.nextAngle,this.turnSpeed*t*60),this.directionEntity.setLocalEulerAngles(0,this.currentAngle*pc.math.RAD_TO_DEG,0),this.applyForce(t)};var Motion=pc.createScript("motion");Motion.attributes.add("motions",{type:"json",schema:[{name:"name",type:"string"},{name:"position",type:"curve",curves:["x","y","z"]},{name:"rotation",type:"curve",curves:["x","y","z"]},{name:"scale",type:"curve",curves:["x","y","z"]},{name:"speed",type:"number",default:1},{name:"autoplay",type:"boolean",default:!1},{name:"loop",type:"boolean",default:!1}],array:!0}),Motion.attributes.add("events",{type:"json",schema:[{name:"animationName",type:"string"},{name:"eventName",type:"string"},{name:"time",type:"number",default:1},{name:"type",type:"string",default:"Anytime",enum:[{Anytime:"Anytime"},{Start:"Start"},{End:"End"}]}],array:!0}),Motion.attributes.add("lerp",{type:"number",default:.5}),Motion.prototype.initialize=function(){this.timestamp=0,this.currentSpeed=0,this.currentMotion=!1,this.isReverting=!1,this.startPosition=this.entity.getLocalPosition().clone(),this.startRotation=this.entity.getLocalEulerAngles().clone(),this.startScale=this.entity.getLocalScale().clone(),this.position=new pc.Vec3(0,0,0),this.rotation=new pc.Vec3(0,0,0),this.scale=new pc.Vec3(0,0,0),this.motions.length>0&&this.motions[0].autoplay&&this.onMotionPlay(this.motions[0].name),this.app.on("Motion",this.onMotionPlay,this),this.app.on("Motion:Stop",this.onMotionStop,this),this.entity.on("Motion",this.onMotionPlay,this),this.entity.on("Motion:Play",this.onMotionPlay,this),this.entity.on("Motion:Stop",this.onMotionStop,this)},Motion.prototype.findMotion=function(t){var i=!1;for(var n in this.motions){var e=this.motions[n];e.name==t&&(i=e)}return i},Motion.prototype.onMotionStop=function(t){this.currentMotion&&this.currentMotion.name==t&&(this.isPlaying=!1,this.currentMotion=!1)},Motion.prototype.onMotionPlay=function(t,i){if(!i&&this.currentMotion&&this.currentMotion.name==t)return!1;var n=this.findMotion(t);if(!n)return!1;this.isPlaying=!0,this.timestamp=0,this.currentMotion=n,this.triggerStartEvent(this.currentMotion)},Motion.prototype.triggerEvents=function(t){for(var i in this.events){var n=this.events[i],e=n.time;n.animationName==this.currentMotion.name&&e>this.timestamp&&e<=this.timestamp+t&&this.app.fire(n.eventName)}},Motion.prototype.findEventByMotion=function(t,i){for(var n in this.events){var e=this.events[n];if(e.animationName==t.name&&e.type==i)return e}},Motion.prototype.triggerStartEvent=function(t){var i=this.findEventByMotion(t,"Start");i&&this.app.fire(i.eventName)},Motion.prototype.triggerEndEvent=function(t){var i=this.findEventByMotion(t,"End");i&&this.app.fire(i.eventName)},Motion.prototype.update=function(t){if(!this.isPlaying)return!1;if(!this.currentMotion)return!1;var i=this.currentMotion.position.value(this.timestamp),n=this.currentMotion.rotation.value(this.timestamp),e=this.currentMotion.scale.value(this.timestamp);this.position=this.position.lerp(this.position,new pc.Vec3(i[0],i[1],i[2]),this.lerp),this.rotation=this.rotation.lerp(this.rotation,new pc.Vec3(n[0],n[1],n[2]),this.lerp),this.scale=this.scale.lerp(this.scale,new pc.Vec3(e[0],e[1],e[2]),this.lerp),this.entity.setLocalPosition(this.position.clone().add(this.startPosition)),this.entity.setLocalEulerAngles(this.rotation.clone().add(this.startRotation)),this.entity.setLocalScale(this.scale.clone().add(this.startScale)),this.triggerEvents(t),this.timestamp>=1&&(this.isPlaying=!1,this.currentMotion.loop?this.onMotionPlay(this.currentMotion.name,!0):(this.triggerEndEvent(this.currentMotion),this.currentMotion=!1)),this.isReverting?(this.timestamp-=t*this.currentMotion.speed,this.timestamp<=0&&(this.triggerEndEvent(this.currentMotion),this.currentMotion=!1,this.isPlaying=!1,this.isReverting=!1)):this.timestamp+=t*this.currentMotion.speed,this.timestamp=Math.max(this.timestamp,0),this.timestamp=Math.min(this.timestamp,1)};var Physics=pc.createScript("physics");Physics.attributes.add("threshold",{type:"number",default:1.1}),Physics.attributes.add("frequency",{type:"number",default:1}),Physics.attributes.add("size",{type:"number",default:100}),Physics.prototype.initialize=function(){this.kinematicCollisions=[],this.recentlyCollided=[],this.leavePool=[]},Physics.prototype.updateKinematic=function(){if(Date.now()-this.lastKinematicUpdate<1e3*this.frequency)return!1;this.kinematicCollisions=[];var t=this;for(var i in pc.app.systems.collision.store){var e=pc.app.systems.collision.store[i];e.entity&&e.entity.tags.list().indexOf("Dynamic")>-1&&(-1===e.entity.tags.list().indexOf("Ghost")?e.entity._translate||(e.entity.revertTranslate=function(i){if(i==this)return!1;var e=this.getPosition();if(!e)return!1;var s=i.getPosition(),o=t.lookAt(s.x,s.z,e.x,e.z),n=e.clone().sub(this.previousPosition).length()*t.threshold,r=o-Math.PI,a=Math.cos(r)*n,l=Math.sin(r)*n;this._translate(-l,0,-a)},e.entity._translate=e.entity.translate,e.entity.previousPosition=e.entity.getPosition().clone(),e.entity.translate=function(i,e,s){this.getPosition().clone();this.previousPosition=this.getPosition().clone(),this._translate(i,e,s);var o=this.getPosition();if(o.x<-t.size/2||o.x>t.size/2||o.z<-t.size/2||o.z>t.size/2){var n=0,r=0;o.x<-t.size/2?n=-t.size/2-o.x:o.x>t.size/2&&(n=t.size/2-o.x),o.z<-t.size/2?r=-t.size/2-o.z:o.z>t.size/2&&(r=t.size/2-o.z),this._translate(n,0,r)}}.bind(e.entity)):e.entity.revertTranslate=function(){},this.kinematicCollisions.push(e.entity))}this.lastKinematicUpdate=Date.now()},Physics.prototype.checkCollisions=function(t){this.triggerPool=[];for(var i=this.kinematicCollisions.length;i--;){for(var e=this.kinematicCollisions[i],s=Object.values(pc.app.systems.collision.store),o=s.length;o--;){(r=s[o])&&r.entity.parent&&r.entity.enabled&&r.entity.collision.enabled&&("sphere"==r.data.type?this.calculateSphereCollision(e,r,t):"box"==r.data.type&&this.calculateBoxCollision(e,r,t))}if(this.triggerPool.sort((function(t,i){return t.distance-i.distance})),this.triggerPool.length>0)for(var n=0;n<this.triggerPool.length;n++){var r=this.triggerPool[n];this.triggerPool[n].object.entity}}},Physics.prototype.calculateSphereCollision=function(t,i,e){if(!t)return!1;if(!t.collision)return!1;var s=t.getPosition().clone().sub(i.entity.getPosition().clone()).length(),o=i.data.radius,n=i.entity.tags.list().indexOf("Ghost")>-1;s<t.collision.radius+o&&(this.triggerPool.push({distance:s,object:i}),i.entity.fire("Trigger",t,e),t.fire("Collision",i.entity),this.addTriggerPool(i.entity,t),n||t.revertTranslate(i.entity))},Physics.prototype.calculateBoxCollision=function(t,i,e){if(!t)return!1;if(!t.collision)return!1;var s=t.getPosition().sub(i.entity.getPosition()).length(),o=t.getPosition(),n=t.collision.radius,r=i.entity.getPosition(),a=i.data.halfExtents,l=i.entity.tags.list().indexOf("Ghost")>-1;o.x>r.x-a.x-n&&o.x<r.x+a.x+n&&o.z>r.z-a.z-n&&o.z<r.z+a.z+n&&(this.triggerPool.push({distance:s,object:i}),i.entity.fire("Trigger",t,e),t.fire("Collision",i.entity),this.addTriggerPool(i.entity,t),l||t.revertTranslate(i.entity))},Physics.prototype.addTriggerPool=function(t,i){for(var e=!1,s=this.leavePool.length;s--;){var o=this.leavePool[s];o.entity===t&&o.who===i&&(e=!0,o.time=Date.now())}e||this.leavePool.push({entity:t,who:i,time:Date.now()})},Physics.prototype.updateTriggerPool=function(t){for(var i=this.leavePool.length;i--;){var e=this.leavePool[i];Date.now()-e.time>300&&(this.leavePool[i].entity.fire("Leave",this.leavePool[i].who),this.leavePool.splice(i,1))}},Physics.prototype.update=function(t){this.updateKinematic(),this.checkCollisions(t),this.updateTriggerPool()},Physics.prototype.lookAt=function(t,i,e,s){return Math.atan2(e-t,s-i)};var CameraFollow=pc.createScript("cameraFollow");CameraFollow.attributes.add("cameraEntity",{type:"entity"}),CameraFollow.attributes.add("levelEntity",{type:"entity"}),CameraFollow.attributes.add("followEntity",{type:"entity"}),CameraFollow.attributes.add("playerEntity",{type:"entity"}),CameraFollow.attributes.add("speed",{type:"number",default:.1}),CameraFollow.prototype.initialize=function(){this.offset=new pc.Vec3(0,0,0),this.levelOffset=14,this.nextOffset=new pc.Vec3(0,0,0),this.cameraOffset=new pc.Vec3(0,0,0),this.isFocusing=!1,this.lastFollowedEntity=!1,this.lastFocusing=!1,this.alreadyFocused=[];var t=Utils.getItem("AlreadyFocused");t&&(this.alreadyFocused=JSON.parse(t)),this.defaultVector=new pc.Vec3(0,0,0),this.app.on("Camera:Focus",this.setCameraFocus,this),this.app.on("Camera:FocusByName",this.setCameraFocusByName,this),this.app.on("Camera:Clear",this.clearCameraFocus,this),this.app.on("Camera:Offset",this.setCameraOffset,this),this.app.keyboard.on("keydown",this.onKeyDown,this)},CameraFollow.prototype.setCameraFocusByName=function(t){this.clearCameraFocus();var e=this.app.root.findByName(t);e&&this.setCameraFocus(e)},CameraFollow.prototype.onKeyDown=function(){this.focusBack()},CameraFollow.prototype.setCameraOffset=function(t){this.nextOffset=t},CameraFollow.prototype.clearCameraFocus=function(){this.lastFollowedEntity=!1,this.followEntity=this.playerEntity,this.alreadyFocused=[]},CameraFollow.prototype.setCameraFocus=function(t,e){return!!t&&(t!=this.followEntity&&(t!=this.lastFollowedEntity&&(!(Date.now()-this.lastFocusing<500)&&(!(this.alreadyFocused.indexOf(t.name)>-1)&&(!(t.getPosition().clone().sub(this.playerEntity).length()<1)&&(this.followEntity=t,this.speed=.05,this.isFocusing=!0,this.entity.sound.play("Spinning"),Timer.clearTimeout(this.cameraTimer),this.lastFollowedEntity=t,this.alreadyFocused.push(t.name),Utils.setItem("AlreadyFocused",JSON.stringify(this.alreadyFocused)),this.lastFollowedEntityTimer=Timer.setTimeout((function(t){t.lastFollowedEntity=!1}),3e3,this),this.cameraTimer=Timer.setTimeout((function(t){t.focusBack()}),e||3e3,this),void(this.lastFocusing=Date.now())))))))},CameraFollow.prototype.focusBack=function(){return this.followEntity!=this.playerEntity&&(!(Date.now()-this.lastFocusing<700)&&(Timer.clearTimeout(this.cameraTimer),this.entity.sound.play("Spinning"),this.followEntity=this.playerEntity,this.speed=.1,void(this.isFocusing=!1)))},CameraFollow.prototype.update=function(t){if(!this.followEntity)return!1;var e=this.entity.getPosition().lerp(this.entity.getPosition(),this.followEntity.getPosition(),this.speed);this.offset=this.offset.lerp(this.offset,this.nextOffset,.05),this.nextOffset=this.nextOffset.lerp(this.nextOffset,this.defaultVector,.01),this.isFocusing?this.entity.setPosition(e):this.entity.setPosition(e.add(this.nextOffset));var i=14;1===this.playerEntity.level&&(i=15),2===this.playerEntity.level&&(i=16),this.playerEntity.level>=3&&(i=18),Utils.isMobile()&&(i*=2),this.levelOffset=pc.math.lerp(this.levelOffset,i,.08),this.levelEntity.setLocalPosition(0,0,this.levelOffset)};var Timeline=pc.createScript("timeline");Timeline.attributes.add("autoplay",{type:"boolean"}),Timeline.attributes.add("loop",{type:"boolean",default:!1}),Timeline.attributes.add("yoyo",{type:"boolean",default:!1}),Timeline.attributes.add("position",{type:"boolean",default:!1}),Timeline.attributes.add("scale",{type:"boolean",default:!1}),Timeline.attributes.add("rotation",{type:"boolean",default:!1}),Timeline.attributes.add("opacity",{type:"boolean",default:!1}),Timeline.attributes.add("custom",{type:"boolean",default:!1}),Timeline.attributes.add("playSound",{type:"boolean",default:!1}),Timeline.attributes.add("duration",{type:"number",default:1}),Timeline.attributes.add("delay",{type:"number",default:0}),Timeline.attributes.add("repeat",{type:"number",default:0}),Timeline.attributes.add("soundDelay",{type:"number",default:0}),Timeline.attributes.add("rollback",{type:"number",default:0}),Timeline.attributes.add("ease",{type:"string",enum:[{Linear:"Linear"},{QuadraticIn:"QuadraticIn"},{QuadraticOut:"QuadraticOut"},{QuadraticInOut:"QuadraticInOut"},{CubicIn:"CubicIn"},{CubicOut:"CubicOut"},{CubicInOut:"CubicInOut"},{QuarticIn:"QuarticIn"},{QuarticOut:"QuarticOut"},{QuarticInOut:"QuarticInOut"},{QuinticIn:"QuinticIn"},{QuinticOut:"QuinticOut"},{QuinticInOut:"QuinticInOut"},{SineIn:"SineIn"},{SineOut:"SineOut"},{SineInOut:"SineInOut"},{ExponentialIn:"ExponentialIn"},{ExponentialOut:"ExponentialOut"},{ExponentialInOut:"ExponentialInOut"},{CircularIn:"CircularIn"},{CircularOut:"CircularOut"},{CircularInOut:"CircularInOut"},{BackIn:"BackIn"},{BackOut:"BackOut"},{BackInOut:"BackInOut"},{BounceIn:"BounceIn"},{BounceOut:"BounceOut"},{BounceInOut:"BounceInOut"},{ElasticIn:"ElasticIn"},{ElasticOut:"ElasticOut"},{ElasticInOut:"ElasticInOut"}],default:"Linear"}),Timeline.attributes.add("startFrame",{type:"json",schema:[{name:"position",type:"vec3"},{name:"rotation",type:"vec3"},{name:"scale",type:"vec3",default:[1,1,1]},{name:"opacity",type:"number",default:1},{name:"custom",type:"string",description:"For example camera.fov = 40"}]}),Timeline.attributes.add("endFrame",{type:"json",schema:[{name:"position",type:"vec3"},{name:"rotation",type:"vec3"},{name:"scale",type:"vec3",default:[1,1,1]},{name:"opacity",type:"number",default:1},{name:"custom",type:"string",description:"For example camera.fov = 40"}]}),Timeline.prototype.initialize=function(){this.animation={custom:0},this.eventListener=!1,this.app.on("Timeline:"+this.entity.name,this.onPlay,this),this.app.on("Timeline:"+this.entity.name+"@Time",this.setTime,this),this.entity.on("Timeline",this.onPlay,this),this.on("destroy",this.onDestroy,this),this.on("state",this.onStateChange,this),this.autoplay&&this.onPlay()},Timeline.prototype.setTime=function(t){this.duration=t},Timeline.prototype.onStateChange=function(t){!0===t?this.autoplay&&this.onPlay():this.reset()},Timeline.prototype.onDestroy=function(){},Timeline.prototype.getEase=function(){return pc[this.ease]},Timeline.prototype.reset=function(){this.positionFrames&&this.positionFrames.stop(),this.rotationFrames&&this.rotationFrames.stop(),this.scaleFrames&&this.scaleFrames.stop(),this.opacityFrames&&this.opacityFrames.stop(),this.customFrames&&this.customFrames.stop()},Timeline.prototype.setFirstFrame=function(options){var frame=this.startFrame;if(options.isReverse&&(frame=this.endFrame),this.position&&this.entity.setLocalPosition(frame.position),this.rotation&&this.entity.setLocalEulerAngles(frame.rotation),this.scale&&this.entity.setLocalScale(frame.scale),this.opacity&&(this.entity.element.opacity=frame.opacity),this.custom){var parts=frame.custom.split(" = "),query=parts[0],value=parseFloat(parts[1]);this.animation.custom=value,eval("this.entity."+this.custom)}},Timeline.prototype.onComplete=function(){},Timeline.prototype.onPlay=function(_options){var self=this,options={isReverse:!1,delay:this.delay,playSound:this.playSound};"object"==typeof _options&&(options.isReverse=!!_options.isReverse),"object"==typeof _options&&(options.playSound=!!_options.playSound),options.playSound&&Timer.setTimeout((function(t){t.entity.sound.play("Sound")}),1e3*this.soundDelay,this);var frame=this.endFrame;if(options.isReverse&&(options.delay=0,frame=this.startFrame),this.reset(),this.setFirstFrame(options),this.position&&(this.positionFrames=this.entity.tween(this.entity.getLocalPosition()).to({x:frame.position.x,y:frame.position.y,z:frame.position.z},this.duration,this.getEase()).delay(options.delay),this.eventListener||(this.eventListener=this.positionFrames.on("complete",this.onComplete,this)),this.loop&&this.positionFrames.loop(!0),this.yoyo&&this.positionFrames.yoyo(!0),this.repeat>0&&this.positionFrames.repeat(this.repeat),this.positionFrames.start()),this.rotation&&(this.rotationFrames=this.entity.tween(this.entity.getLocalEulerAngles()).rotate({x:frame.rotation.x,y:frame.rotation.y,z:frame.rotation.z},this.duration,this.getEase()).delay(options.delay),this.eventListener||(this.eventListener=this.rotationFrames.on("complete",this.onComplete,this)),this.loop&&this.rotationFrames.loop(!0),this.yoyo&&this.rotationFrames.yoyo(!0),this.repeat>0&&this.rotationFrames.repeat(this.repeat),this.rotationFrames.start()),this.scale&&(this.scaleFrames=this.entity.tween(this.entity.getLocalScale()).to({x:frame.scale.x,y:frame.scale.y,z:frame.scale.z},this.duration,this.getEase()).delay(options.delay),this.eventListener||(this.eventListener=this.scaleFrames.on("complete",this.onComplete,this)),this.loop&&this.scaleFrames.loop(!0),this.yoyo&&this.scaleFrames.yoyo(!0),this.repeat>0&&this.scaleFrames.repeat(this.repeat),this.scaleFrames.start()),this.opacity&&(this.opacityFrames=this.entity.tween(this.entity.element).to({opacity:frame.opacity},this.duration,this.getEase()).delay(options.delay),this.eventListener||(this.eventListener=this.opacityFrames.on("complete",this.onComplete,this)),this.loop&&this.opacityFrames.loop(!0),this.yoyo&&this.opacityFrames.yoyo(!0),this.repeat>0&&this.opacityFrames.repeat(this.repeat),this.opacityFrames.start()),this.custom){var parts=frame.custom.split(" = "),query=parts[0],value=parseFloat(parts[1]);this.customFrames=this.entity.tween(this.animation).to({custom:value},this.duration,this.getEase()).delay(options.delay),this.customFrames.on("update",(function(){eval("this.entity."+query+" = "+self.animation.custom)})),this.customFrames.start()}this.rollback>0&&!options.isReverse&&Timer.setTimeout((function(t){t.onPlay({isReverse:!0})}),1e3*this.rollback,this)};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);if(this._add.length){for(let t=0;t<this._add.length;t++)this._tweens.indexOf(this._add[t])>-1||this._tweens.push(this._add[t]);this._add.length=0}}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,s;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,s))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,void 0!==this._properties.w?(this._fromQuat.copy(this.target),this._toQuat.set(i,e,s,this._properties.w)):(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),this._toQuat.setFromEulerAngles(i,e,s)))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=0===this.duration?1:this.time/this.duration,r=this.easing(n);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){pc.AppBase.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.AppBase.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.AppBase.getApplication();t&&t.addTweenManager()}();var MoneyManager=pc.createScript("moneyManager");MoneyManager.attributes.add("startMoney",{type:"number",default:8}),MoneyManager.attributes.add("moneyColor",{type:"entity"}),MoneyManager.attributes.add("noMoneyAlert",{type:"entity"}),MoneyManager.attributes.add("moneyEntity",{type:"entity"}),MoneyManager.attributes.add("coinEntity",{type:"entity"}),MoneyManager.attributes.add("losePercent",{type:"number",default:50}),MoneyManager.prototype.initialize=function(){this.money=this.startMoney,this.totalMoney=this.startMoney,this.lastMoneySave=-1,Utils.getItem("Money")&&(this.money=parseInt(Utils.getItem("Money"))),isNaN(this.money)&&(this.money=0),this.app.on("Money:Remove",this.remove,this),this.app.on("Money:Add",this.add,this),this.app.on("Money:Has",this.has,this),this.app.on("Money:NoMoney",this.showNoMoney,this),this.app.on("Money:Reset",this.onReset,this),this.app.on("Money:LoseMoney",this.onLoseMoney,this),this.payMultiplier=1,this.app.on("Money:Pay",this.pay,this),this.app.on("Money:SetPayMultiplier",this.onSetPayMultiplier,this),this.updateMoney(),pc.MoneyManager=this},MoneyManager.prototype.onReset=function(){this.money=0,this.updateMoney()},MoneyManager.prototype.onLoseMoney=function(){this.money-=Math.floor(this.money*(this.losePercent/100)),this.updateMoney()},MoneyManager.prototype.onSetPayMultiplier=function(e){this.payMultiplier=parseInt(e)},MoneyManager.prototype.pay=function(e,t,n){e*=this.payMultiplier;for(var o=0;o<e;o++){var i=this.coinEntity.clone();i.setLocalPosition(t.clone().add(new pc.Vec3(3*(Math.random()-Math.random()),0,3*(Math.random()-Math.random())))),i.enabled=!0,i.script.coin.type=n,this.entity.addChild(i)}},MoneyManager.prototype.showNoMoney=function(){this.noMoneyAlert.enabled||(this.entity.sound.play("NoMoney"),this.noMoneyAlert.enabled=!0,this.noMoneyTimer=Timer.setTimeout((function(e){e.noMoneyAlert.enabled=!1}),1e3,this))},MoneyManager.prototype.has=function(e,t,n){var o=parseInt(e);this.money>=o?t&&t():n&&n()},MoneyManager.prototype.remove=function(e){e<=this.money&&(this.money-=parseInt(e)),this.updateMoney(),this.entity.sound.play("Remove")},MoneyManager.prototype.add=function(e,t){this.money+=parseInt(e),this.totalMoney+=parseInt(e),this.updateMoney(),this.entity.sound.play("Add"),this.app.fire("Money:Added",e,this.money)},MoneyManager.prototype.updateMoney=function(){this.moneyEntity.element.text=this.money+"",Date.now()-this.lastMoneySave>1e3&&(Utils.setItem("Money",this.money),this.lastMoneySave=Date.now()),this.money<=0?this.moneyColor.element.color=pc.Color.RED:this.moneyColor.element.color=pc.Color.BLACK};var Coin=pc.createScript("coin");Coin.attributes.add("type",{type:"string",default:"None"}),Coin.attributes.add("value",{type:"number",default:5}),Coin.attributes.add("coinDisplay",{type:"entity"}),Coin.prototype.initialize=function(){this.createdAt=Date.now(),this.isDestroyed=!1,setTimeout((function(t){t.entity.collision.enabled=!0}),300,this),this.entity.on("Trigger",this.onTrigger,this)},Coin.prototype.update=function(t){Date.now()-this.createdAt>1e4&&this.entity.destroy()},Coin.prototype.onTrigger=function(t){return!this.isDestroyed&&(!(Date.now()-this.createdAt<60)&&(!!t&&(-1!==t.tags.list().indexOf("Player")&&(!!t.collision.enabled&&("Player"==t.name&&(this.app.fire("Money:Add",this.value,this.type),this.app.fire("Player:Score",this.value),this.app.fire("World2Screen:Animate","Coin",this.entity.getPosition(),this.coinDisplay)),this.entity.destroy(),void(this.isDestroyed=!0))))))};var Rotate=pc.createScript("rotate");Rotate.attributes.add("axis",{type:"string",enum:[{x:"x"},{y:"y"},{z:"z"}]}),Rotate.attributes.add("speed",{type:"number"}),Rotate.attributes.add("waveStyle",{type:"boolean"}),Rotate.attributes.add("waveWidth",{type:"number"}),Rotate.attributes.add("children",{type:"boolean"}),Rotate.attributes.add("graphName",{type:"string"}),Rotate.prototype.initialize=function(){this.currentElement=this.entity,this.timestamp=0,this.children&&(this.currentElement=this.entity.findByName(this.graphName))},Rotate.prototype.update=function(t){var e=this.speed*(60*t);this.waveStyle&&(e=Math.cos(this.timestamp*this.speed)*this.waveWidth,this.timestamp+=60*t),this.currentElement?("x"==this.axis&&this.currentElement.rotateLocal(e,0,0),"y"==this.axis&&this.currentElement.rotateLocal(0,e,0),"z"==this.axis&&this.currentElement.rotateLocal(0,0,e)):this.children&&(this.currentElement=this.entity.findByName(this.graphName))};var World2ScreenAnimate=pc.createScript("world2ScreenAnimate");World2ScreenAnimate.attributes.add("elements",{type:"entity",array:!0}),World2ScreenAnimate.attributes.add("speed",{type:"number",default:1}),World2ScreenAnimate.attributes.add("randomModifier",{type:"number",default:0}),World2ScreenAnimate.attributes.add("scaleCurve",{type:"curve",curves:["x"]}),World2ScreenAnimate.attributes.add("cameraEntity",{type:"entity"}),World2ScreenAnimate.attributes.add("holderEntity",{type:"entity"}),World2ScreenAnimate.prototype.initialize=function(){this.movingElements=[],this.elements.forEach((function(e){e.enabled=!1})),this.app.on("World2Screen:Animate",this.onCollect,this)},World2ScreenAnimate.prototype.onCollect=function(e,t,n){var i=this.getElementByName(e);if(i){var r=this.getScreenPosition(t),a=n.getPosition().clone(),o=i.clone(),s=(Math.random()-Math.random())*this.randomModifier;o.setLocalPosition(r.x+s,r.y+s,0),o.enabled=!0,this.movingElements.push({timestamp:0,element:o,screenPosition:r,destinationPosition:a}),this.holderEntity.addChild(o)}},World2ScreenAnimate.prototype.getScreenPosition=function(e){if(!this.cameraEntity)return console.warn("Camera doesnt exist!"),!1;var t=new pc.Vec3,n=this.cameraEntity.camera,i=this.app.graphicsDevice.maxPixelRatio,r=this.entity.screen.scale,a=this.app.graphicsDevice;return n?(n.worldToScreen(e,t),t.x*=i,t.y*=i,new pc.Vec2(t.x/r,(a.height-t.y)/r)):(console.warn("Camera doesnt exist!"),!1)},World2ScreenAnimate.prototype.getElementByName=function(e){for(var t=0;t<this.elements.length;t++)if(this.elements[t].name===e)return this.elements[t];return null},World2ScreenAnimate.prototype.update=function(e){for(var t=this.movingElements.length;t--;){var n=this.movingElements[t];if(n&&(n.timestamp+=e*this.speed,n.timestamp>0)){var i=n.timestamp,r=this.scaleCurve.value(i),a=n.element.getPosition();i>.25&&a.lerp(a,n.destinationPosition,.1),n.element.setPosition(a),n.element.setLocalScale(r,r,r),i>=1&&(this.movingElements.splice(t,1),n.element.destroy())}}};var Cannon=pc.createScript("cannon");Cannon.attributes.add("speed",{type:"number",default:1}),Cannon.attributes.add("damage",{type:"number",default:1}),Cannon.attributes.add("modelEntity",{type:"entity"}),Cannon.attributes.add("particleEntity",{type:"entity"}),Cannon.prototype.initialize=function(){this.isDestroyed=!1,this.createdAt=Date.now(),this.lastDestroyTime=-1,this.entity.on("Collision",this.onCollision,this),this.app.fire("Player:AddCannon",this.entity)},Cannon.prototype.onCollision=function(t){return!(Date.now()-this.createdAt<20)&&(!this.isDestroyed&&(this.entity.ownerEntity!=t&&(-1!==t.tags.list().indexOf("Hittable")&&(t&&t.fire("Damage",this.damage,this.entity.ownerEntity),"Player"==this.entity.ownerEntity.name&&(this.app.fire("Overlay:Sound","Hit"),this.app.fire("EffectManager:Explosion",this.entity.getPosition().clone()),this.app.fire("Motion","Shake"),this.entity.sound.play("Impact")),"Bandit"!=t.name&&"Rock"!=t.name||this.app.fire("EffectManager:Explosion",this.entity.getPosition().clone()),void this.scheduleDestroy()))))},Cannon.prototype.scheduleDestroy=function(){this.modelEntity.destroy(),this.app.fire("Player:RemoveCannon",this.entity),this.lastDestroyTime=Date.now(),this.isDestroyed=!0},Cannon.prototype.update=function(t){if(this.isDestroyed)return Date.now()-this.lastDestroyTime>3e3&&this.entity.destroy(),!1;this.entity.translateLocal(0,0,this.speed*t),Date.now()-this.createdAt>2e3&&this.scheduleDestroy()};var Enemy=pc.createScript("enemy");Enemy.attributes.add("shipEntity",{type:"entity"}),Enemy.attributes.add("upgradeManagerEntity",{type:"entity"}),Enemy.attributes.add("modelEntity",{type:"entity"}),Enemy.attributes.add("mirrorEntity",{type:"entity"}),Enemy.attributes.add("maxHealth",{type:"number",default:100}),Enemy.attributes.add("minimapCursorEntity",{type:"entity"}),Enemy.attributes.add("minimapHolder",{type:"entity"}),Enemy.attributes.add("minimapScale",{type:"number",default:1}),Enemy.prototype.postInitialize=function(){this.entity.maxHealth=this.maxHealth,this.entity.health=this.maxHealth,this.entity.active=!0,this.entity.score=Math.floor(200*Math.random()),this.lastShoot=Date.now(),this.entity.on("Damage",this.doDamage,this),this.entity.on("Set",this.setDetails,this),this.entity.on("Score",this.addScore,this),this.entity.on("Heal",this.onHeal,this),this.on("destroy",this.onDestroy,this),this.app.fire("Enemy:Add",this.entity),this.setLevel(),this.setDamage(),this.entity.fire("Flag")},Enemy.prototype.setLevel=function(){var t=this.entity.level;1==t&&(this.entity.health=100,this.entity.maxHealth=100),2==t&&(this.entity.health=125,this.entity.maxHealth=125),3==t&&(this.entity.health=200,this.entity.maxHealth=200),t>=5&&(this.entity.health=350,this.entity.maxHealth=350),t>=8&&(this.entity.health=600,this.entity.maxHealth=600)},Enemy.prototype.setDamage=function(){var t=this.entity.level,e=this.upgradeManagerEntity.script.upgradeManager.damages[t];this.shipEntity.script.ship.damage=e},Enemy.prototype.onDestroy=function(){this.minimapCursor&&this.minimapCursor.destroy()},Enemy.prototype.onHeal=function(){this.entity.health=parseInt(this.entity.maxHealth+""),this.updateHealth()},Enemy.prototype.addScore=function(){this.entity.score+=Math.floor(30*Math.random())+5},Enemy.prototype.setDetails=function(t){this.entity.username=t.username,this.entity.fire("Label:Update")},Enemy.prototype.doDamage=function(t,e){this.app.fire("DealtDamage:Trigger",t,this.entity.getPosition()),this.entity.health-=t,this.updateHealth(e)},Enemy.prototype.getTotalCoins=function(){var t=5;return this.entity.score>30?t=10:this.entity.score>50?t=15:this.entity.score>100?t=20:this.entity.score>200&&(t=25),t},Enemy.prototype.death=function(t){this.entity.destroy(),this.app.fire("Money:Pay",this.getTotalCoins(),this.entity.getPosition()),this.app.fire("EnemyManager:Death"),this.app.fire("KillLog:Add",t.username,this.entity.username),this.app.fire("Overlay:Kill",t),this.app.fire("Enemy:Remove",this.entity),t.fire("Score",this.entity)},Enemy.prototype.updateHealth=function(t){this.entity.health<=0&&this.death(t)},Enemy.prototype.updateMinimap=function(){if(Date.now()-this.lastMinimapUpdate<1e3)return!1;var t=this.entity.getPosition();this.minimapCursor.setLocalPosition(t.x*this.minimapScale,-t.z*this.minimapScale,0),this.lastMinimapUpdate=Date.now()},Enemy.prototype.update=function(t){Date.now(),this.lastShoot};var DealtDamage=pc.createScript("dealtDamage");DealtDamage.attributes.add("numberEntity",{type:"entity"}),DealtDamage.attributes.add("holderEntity",{type:"entity"}),DealtDamage.prototype.initialize=function(){this.numbers=[],this.lastDamage=100,this.defaultOffset=new pc.Vec3(0,0,0),this.isMinus=1,this.cameraEntity=this.app.root.findByName("Lens"),this.numberEntity.enabled=!1,this.app.on("DealtDamage:Trigger",this.onDamageDealt,this)},DealtDamage.prototype.destroyEntity=function(e){this.numbers.splice(this.numbers.indexOf(e),1),e.destroy()},DealtDamage.prototype.onDamageDealt=function(e,t,a){var i=this.numberEntity.clone();e<=.99&&(e=1),i.element.text=e>0?Math.round(e)+"":e,this.offset=this.defaultOffset,i.player=new pc.Vec3(t.x,t.y,t.z),i.element.offsetX=50*Math.random()-50*Math.random(),i.element.offsetY=-1.7,i.element.opacity=1;var n=3,s=.3;a&&(n=4,s=1,i.element.color=pc.Color.RED),this.lastDamage=e;var o=i.tween(i.getLocalScale()).to({x:n,y:n,z:n},.15,pc.BounceOut);o.on("complete",(function(){this.entity.tween(this.entity.getLocalScale()).to({x:1,y:1,z:1},.4,pc.BounceOut).start()})),o.start(),i.tween(i.element).to({offsetY:0},.3,pc.Linear).start().on("complete",(function(){i.tween(i.element).to({opacity:0,offsetY:.8},s,pc.Linear).delay(.5).start()})),setTimeout((function(e,t){e.destroyEntity(t)}),3e3,this,i),this.numbers.push(i),this.holderEntity.addChild(i)},DealtDamage.prototype.updateNumberPosition=function(e){var t=new pc.Vec3,a=this.cameraEntity.camera,i=this.app.graphicsDevice.maxPixelRatio,n=this.entity.screen.scale,s=this.app.graphicsDevice,o=!1;return o=e.player.name?e.player.getPosition().clone().add(this.offset):e.player,!!a&&(!!e&&(a.worldToScreen(o,t),t.x*=i,t.y*=i,void(t.x>0&&t.x<this.app.graphicsDevice.width&&t.y>0&&t.y<this.app.graphicsDevice.height&&t.z>0?(e.setLocalPosition(t.x/n+e.element.offsetX,(s.height-t.y)/n+this.isMinus*Math.cos(e.element.offsetY)*Math.cos(e.element.offsetY)*120+(this.isMinus<0?150:0),0),e.element.outlineThickness=e.element.opacity,e.enabled=!0):e.enabled=!1)))},DealtDamage.prototype.update=function(e){for(var t=this.numbers.length;t--;)this.updateNumberPosition(this.numbers[t])};var Label=pc.createScript("label");Label.attributes.add("type",{type:"string",default:"Dragon"}),Label.attributes.add("offset",{type:"vec3",default:[0,1.25,0]}),Label.prototype.initialize=function(){this.healthRatio=1,this.isLabelCreated=!1,pc.isGameReady?this.onReady():this.app.on("Mount:Ready",this.onReady,this),this.entity.on("Label:Update",this.updateLabel,this),this.entity.on("Damage",this.onDamage,this),this.entity.on("Level",this.setLevel,this)},Label.prototype.onDamage=function(){this.labelEntity&&this.labelEntity.fire("Timeline")},Label.prototype.onReady=function(){if(this.isLabelCreated)return!1;this.app.fire("World2Screen:Clone",this.type,this.entity,this.offset,this.onLabel.bind(this))},Label.prototype.onLabel=function(t){this.labelEntity=t,this.healthEntity=t.findByName("Health"),this.nameEntity=t.findByName("Name"),this.topEntity=t.findByName("Top"),this.nameEntity&&(this.nameEntity.element.text=this.entity.username),this.setLevel(),this.isLabelCreated=!0},Label.prototype.updateLabel=function(){this.nameEntity&&(this.nameEntity.element.text=this.entity.username)},Label.prototype.setLevel=function(){this.topEntity},Label.prototype.update=function(t){if(!this.isLabelCreated)return!1;this.healthRatio=pc.math.lerp(this.healthRatio,Math.max(1*this.entity.health/this.entity.maxHealth,0),.1),this.healthEntity.setLocalScale(this.healthRatio,1,1)};var EffectManager=pc.createScript("effectManager");EffectManager.attributes.add("explosionEffect",{type:"entity"}),EffectManager.attributes.add("shootTrace",{type:"entity"}),EffectManager.prototype.initialize=function(){this.app.on("EffectManager:Explosion",this.playExplosionEffect,this),this.app.on("EffectManager:ShootTrace",this.setShootTrace,this)},EffectManager.prototype.setShootTrace=function(t,e){var o=this.shootTrace.clone();o.setPosition(t),o.setLocalEulerAngles(0,e*pc.math.RAD_TO_DEG,0),o.enabled=!0,this.entity.addChild(o),setTimeout((function(t){o.destroy()}),1500,this)},EffectManager.prototype.playExplosionEffect=function(t){this.explosionEffect.enabled=!0,this.explosionEffect.setPosition(t),this.explosionEffect.findByName("Sprite").sprite.play("Fire")};var LookAt=pc.createScript("lookAt");LookAt.prototype.initialize=function(){this.cameraEntity=this.app.root.findByName("Lens")},LookAt.prototype.update=function(t){this.entity.lookAt(this.cameraEntity.getPosition())};var Cursor=pc.createScript("cursor");Cursor.attributes.add("cameraEntity",{type:"entity"}),Cursor.attributes.add("originEntity",{type:"entity"}),Cursor.attributes.add("playerEntity",{type:"entity"}),Cursor.attributes.add("enemyManager",{type:"entity"}),Cursor.attributes.add("screenEntity",{type:"entity"}),Cursor.attributes.add("uiEntity",{type:"entity"}),Cursor.prototype.initialize=function(){this.ground=new pc.BoundingBox(new pc.Vec3(0,0,0),new pc.Vec3(100,.01,100)),this.ray=new pc.Ray,this.mouse=new pc.Vec2,this.hitPosition=new pc.Vec3,this.app.mouse&&!Utils.isMobile()&&(this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this))},Cursor.prototype.onMouseDown=function(t){return!Utils.isMobile()&&(!pc.hasActiveInterface&&(!pc.Mouse.isPointerLocked()&&(console.log(pc.lastClickTime),!(Date.now()-pc.lastClickTime<100)&&(this.mouse.x=t.x,this.mouse.y=t.y,void this.app.mouse.enablePointerLock()))))},Cursor.prototype.onMouseMove=function(t){return!pc.hasActiveInterface&&(pc.Mouse.isPointerLocked()?(this.mouse.x+=t.dx,this.mouse.y+=t.dy,this.mouse.x=Math.min(Math.max(this.mouse.x,0),window.innerWidth),void(this.mouse.y=Math.min(Math.max(this.mouse.y,0),window.innerHeight))):(this.mouse.x=t.x,this.mouse.y=t.y,!1))},Cursor.prototype.setScale=function(){for(var t=!1,i=this.enemyManager.script.enemyManager.enemies,e=i.length;e--;){var s=i[e];s.getPosition().clone().distance(this.originEntity.getPosition())<1.5&&(t=s)}t?(this.playerEntity.fire("Cursor:Target",t),this.originEntity.setLocalScale(1.5,1.5,1.5)):this.originEntity.setLocalScale(1,1,1)},Cursor.prototype.update=function(t){var i=this.screenEntity.screen.scale,e=this.app.graphicsDevice;this.uiEntity.setLocalPosition(this.mouse.x/i,(e.height-this.mouse.y)/i,0),this.cameraEntity.camera.screenToWorld(this.mouse.x,this.mouse.y,1e3,this.ray.direction),this.ray.origin.copy(this.cameraEntity.getPosition()),this.ray.direction.sub(this.ray.origin).normalize();this.ground.intersectsRay(this.ray,this.hitPosition);this.entity.setPosition(this.hitPosition.x,0,this.hitPosition.z),this.setScale()};var PopupManager=pc.createScript("popupManager");PopupManager.attributes.add("popupEntity",{type:"entity"}),PopupManager.prototype.initialize=function(){this.popupEntity.enabled=!1,this.views=this.popupEntity.findByTag("View"),this.popupName="";for(var i=0;i<this.views.length;i++)this.views[i].enabled=!1;this.app.on("PopupManager:Show",this.onShow,this),this.app.on("PopupManager:Hide",this.onHide,this)},PopupManager.prototype.onShow=function(i){if(i==this.popupName&&this.popupEntity.enabled)return!1;pc.hasActiveInterface=!0,this.popupName=i,this.app.mouse.disablePointerLock(),this.popupEntity.enabled=!0,this.app.fire("Timeline:Popup");for(var e=0;e<this.views.length;e++)this.views[e].name===i?this.views[e].enabled=!0:this.views[e].enabled=!1;Utils.addEvent(i),PokiPlugin.onPause()},PopupManager.prototype.onHide=function(){pc.hasActiveInterface=!1,this.popupEntity.enabled=!1,this.app.mouse.enablePointerLock(),PokiPlugin.isSatisfied=!0,PokiPlugin.checkSatisfaction()?(PokiPlugin.showConditionedMidroll(),Utils.addEvent("conditioned_midroll")):PokiPlugin.onPlay()};var Timer={nextTimerId:0,timers:[],init:function(){pc.app.on("update",this.onUpdate,this)},setTimeout:function(t,i,e,n,o){return setTimeout(t,i,e,n,o)},clearTimeout:function(t){clearTimeout(t)},onUpdate:function(t){}};Timer.init();var Interaction=pc.createScript("interaction");Interaction.attributes.add("speed",{type:"number",default:1.5}),Interaction.attributes.add("triggerName",{type:"string",default:"Upgrades"}),Interaction.prototype.postInitialize=function(){this.progress=0,this.entity.on("Trigger",this.onTrigger,this),this.entity.on("Leave",this.onLeave,this),this.app.fire("World2Screen:Clone","Progress",this.entity,!1,this.setDisplay.bind(this)),this.on("destroy",this.onDestroy,this),this.app.on("PopupManager:Hide",this.onHide,this)},Interaction.prototype.onDestroy=function(){this.app.off("PopupManager:Hide",this.onHide,this)},Interaction.prototype.onHide=function(){this.progressionEntity&&(this.progress=0,this.progressionEntity.fire("Progress",this.progress),this.progressionEntity.visible=!1,this.lastInteraction=Date.now())},Interaction.prototype.setDisplay=function(t){this.progressionEntity=t,this.progressionEntity.visible=!1},Interaction.prototype.onTrigger=function(t,i){return!!this.enabled&&(!(Date.now()-this.lastInteraction<1500)&&("Player"==t.name&&(this.progress+=i*this.speed,this.progressionEntity&&(this.progressionEntity.visible=!0,this.progressionEntity.fire("Progress",this.progress)),void(this.progress>1&&(this.progress=0,this.progressionEntity.visible=!1,this.entity.fire("Interaction",t),this.app.fire("PopupManager:Show",this.triggerName),this.lastInteraction=Date.now())))))},Interaction.prototype.onLeave=function(){return!!this.enabled&&(!(Date.now()-this.lastInteraction<3e3)&&(this.progress=0,this.progressionEntity.fire("Progress",this.progress),this.progressionEntity.visible=!1,void(this.lastInteraction=Date.now())))};var World2Screen=pc.createScript("world2Screen");World2Screen.attributes.add("cameraEntity",{type:"entity"}),World2Screen.attributes.add("holderEntity",{type:"entity"}),World2Screen.attributes.add("display",{type:"entity",array:!0}),World2Screen.prototype.postInitialize=function(){this.interactions=[],this.frameDrawn=0,this.nextFrameVisible=!1,this.app.on("World2Screen:Clone",this.cloneInteraction,this),this.app.on("World2Screen:Show",this.addInteraction,this),this.app.on("World2Screen:Visible",this.visibleInteraction,this),this.app.on("World2Screen:Hide",this.removeInteraction,this),this.hideAllDisplays(),this.on("destroy",this.onDestroy,this)},World2Screen.prototype.hideAllDisplays=function(){for(var e in this.display){this.display[e].enabled=!1}},World2Screen.prototype.onDestroy=function(){this.app.off("World2Screen:Show",this.setInteraction,this)},World2Screen.prototype.getInteractionDisplay=function(e){var t=!1;for(var i in this.display){var n=this.display[i];n.name==e&&(t=n)}return t},World2Screen.prototype.removeInteraction=function(e,t){var i=this.getInteractionDisplay(e);i&&(i.enabled=!1,i.entity=!1)},World2Screen.prototype.addInteraction=function(e,t,i,n){var r=this.getInteractionDisplay(e);r&&(r.entity!=t&&(r.enabled=!1),r.offset=i||new pc.Vec3(0,0,0),r.entity=t,r.type=e,r.enabled=!0,r.createdAt=Date.now(),n>0&&(Timer.clearTimeout(this.interactionTimer),this.interactionTimer=Timer.setTimeout((function(t){t.removeInteraction(e)}),1e3*n,this)))},World2Screen.prototype.cloneInteraction=function(e,t,i,n,r){var o=this.getInteractionDisplay(e),a=this;o&&((o=o.clone()).name=t._guid,o.enabled=!0,o.offset=i||new pc.Vec3(0,0,0),o.entity=t,o.type=e,o.enabled=!0,o.createdAt=Date.now(),o.destroyAfter=r,n&&n(o),t.parentDisplay=o,t.on("destroy",(function(){o.destroy(),a.display.splice(a.display.indexOf(o),1)})),this.holderEntity.addChild(o),this.display.push(o))},World2Screen.prototype.visibleInteraction=function(e,t,i){this.addInteraction(e,t,i),this.frameDrawn=0,this.nextFrameVisible=e},World2Screen.prototype.updateInteraction=function(e){if(!this.cameraEntity)return!1;var t=new pc.Vec3,i=this.cameraEntity.camera,n=this.app.graphicsDevice.maxPixelRatio,r=this.entity.screen.scale,o=this.app.graphicsDevice;if(!i)return!1;if(!e.entity)return!1;if(e.offset&&e.offset.name?i.worldToScreen(e.offset.getPosition().clone(),t):i.worldToScreen(e.entity.getPosition().clone().add(e.offset),t),t.x*=n,t.y*=n,void 0!==e.visible&&!1===e.visible)return e.setLocalPosition(-1e3,-1e3,0),!1;if(t.x>0&&t.x<this.app.graphicsDevice.width&&t.y>0&&t.y<this.app.graphicsDevice.height&&t.z>0?(e.setLocalPosition(t.x/r,(o.height-t.y)/r,0),e.enabled=e.entity.enabled):e.enabled=!1,e.destroyAfter>0&&Date.now()-e.createdAt>1e3*e.destroyAfter){this.display.indexOf(e);e.destroy()}},World2Screen.prototype.update=function(e){for(var t=this.display.length;t--;){var i=this.display[t];i&&this.updateInteraction(i)}this.nextFrameVisible&&this.frameDrawn>0&&this.removeInteraction(this.nextFrameVisible),this.frameDrawn++};var Progress=pc.createScript("progress");Progress.attributes.add("checkEntity",{type:"entity"}),Progress.prototype.initialize=function(){this.checkEntity&&(this.checkEntity.enabled=!1),this.entity.parent.on("Progress",this.onProgress,this)},Progress.prototype.onProgress=function(t){this.entity.fire("MaterialShader:Set","progress",t),this.checkEntity&&(this.checkEntity.enabled=t>=1)};var MaterialShader=pc.createScript("materialShader");MaterialShader.attributes.add("inEditor",{type:"boolean",default:!0,title:"In Editor"}),MaterialShader.attributes.add("autoplay",{type:"boolean",default:!0}),MaterialShader.attributes.add("continuous",{type:"boolean",default:!0}),MaterialShader.attributes.add("isDebug",{type:"boolean",default:!1}),MaterialShader.attributes.add("isElement",{type:"boolean",default:!1}),MaterialShader.attributes.add("isStatic",{type:"boolean",default:!1}),MaterialShader.attributes.add("isBatched",{type:"boolean",default:!1}),MaterialShader.attributes.add("color",{type:"boolean",default:!0}),MaterialShader.attributes.add("transform",{type:"boolean",default:!0}),MaterialShader.attributes.add("light",{type:"boolean",default:!0}),MaterialShader.attributes.add("material",{type:"asset",assetType:"material"}),MaterialShader.attributes.add("textures",{type:"json",schema:[{name:"name",type:"string",default:"texture_0"},{name:"texture",type:"asset",assetType:"texture"}],array:!0}),MaterialShader.attributes.add("colors",{type:"json",schema:[{name:"name",type:"string",default:"color_0"},{name:"color",type:"rgba"}],array:!0}),MaterialShader.attributes.add("vectors",{type:"json",schema:[{name:"name",type:"string",default:"vector_0"},{name:"vector",type:"vec2"}],array:!0}),MaterialShader.attributes.add("numbers",{type:"json",schema:[{name:"name",type:"string",default:"number_0"},{name:"number",type:"number",default:0}],array:!0}),MaterialShader.attributes.add("curves",{type:"json",schema:[{name:"name",type:"string",default:"curve_0"},{name:"curve",type:"curve",curves:["x","y","z"]},{name:"speed",type:"number",default:1}],array:!0}),MaterialShader.attributes.add("billboard",{type:"boolean",default:!1}),MaterialShader.attributes.add("vertexSet",{type:"boolean",default:!1}),MaterialShader.attributes.add("cloneMaterial",{type:"boolean",default:!1}),MaterialShader.attributes.add("alphaRef",{type:"number",default:.15}),MaterialShader.attributes.add("meshIndex",{type:"number",default:0}),MaterialShader.attributes.add("shader",{type:"string",default:"dmVjNCBnZXRDb2xvcih2ZWMyIFVWKXsKLy92ZWMzIHRleHR1cmVfY29sb3IgPSB0ZXh0dXJlMkQodGV4dHVyZV8wLCBVVikucmdiOwpjb2xvci5yZ2IgPSB2ZWMzKDAuMCwgMS4wLCAwLjApOwpjb2xvci5hID0gMS4wOwoKcmV0dXJuIGNvbG9yOwp9Cgp2ZWMzIGdldFZlcnRleCh2ZWMzIGxvY2FsUG9zaXRpb24sIHZlYzMgd29ybGRQb3NpdGlvbiwgdmVjMiBVVil7CnZlcnRleC54eXogPSB2ZWMzKDAuMCwgMC4wLCAwLjApOwoKcmV0dXJuIHZlcnRleDsKfQ=="}),MaterialShader.prototype.initialize=function(){this.parameters=[],this.once=!1,this.isPlaying=this.autoplay,this.reset(),this.isDebug?this.addCodeEditor():(this.emissive=atob(this.shader),this.updateMaterial()),this.on("attr:textures",this.onAttributeChange,this),this.on("attr:colors",this.onAttributeChange,this),this.on("attr:vectors",this.onAttributeChange,this),this.on("attr:numbers",this.onAttributeChange,this),this.on("attr:curves",this.onAttributeChange,this),this.on("attr:shader",this.onAttributeChange,this),this.entity.on("MaterialShader:Set",this.setVariable,this),this.entity.on("MaterialShader:Play",this.onPlay,this),this.on("state",this.onStateChange,this),this.on("destroy",this.onDestroy,this),this.entity.on("Model:Loaded",this.onModelLoaded,this),this.entity.on("Model:Reload",this.reload,this),this.app.on("MaterialShader:Reset",this.onStateChange,this),this.material&&(this.totalAssets=2+this.textures.length,this.loaded=0,this.loadAllAssets()),this.isElement&&this.onAttributeChange()},MaterialShader.prototype.reload=function(){this.totalAssets=2+this.textures.length,this.loaded=0,this.loadAllAssets()},MaterialShader.prototype.loadAllAssets=function(){if(this.isElement)return this.loaded=this.totalAssets,Timer.setTimeout((function(t){t.isLoaded()}),100,this),!1;var t=this,e=this.entity.model.asset,a=this.app.assets.get(e);for(var i in a?(a.ready((function(){t.loaded++,t.isLoaded()})),this.app.assets.load(a)):(this.loaded++,this.isLoaded()),this.material.ready((function(){t.loaded++,t.isLoaded()})),this.app.assets.load(this.material),this.textures){var r=this.textures[i];r.texture.ready((function(){t.loaded++,t.isLoaded()})),this.app.assets.load(r.texture)}},MaterialShader.prototype.onPlay=function(){this.isPlaying=!0,this.timestamp=0},MaterialShader.prototype.isLoaded=function(){this.loaded>=this.totalAssets&&(this.isBatched?Timer.setTimeout((function(t){t.getMaterialByBatch(),t.updateMaterial()}),100,this):(this.cloneMaterial?(this.currentMaterial=this.material.resource.clone(),this.isElement?this.entity.element.material=this.currentMaterial:this.entity.model.meshInstances[this.meshIndex].material=this.currentMaterial):this.currentMaterial=this.material.resource,this.updateMaterial()))},MaterialShader.prototype.setVariable=function(t,e){for(var a in this.parameters){var i=this.parameters[a];i.name==t&&(this.parameters[a].resource=e),this.currentMaterial.setParameter(i.name,i.resource)}},MaterialShader.prototype.updateDynamicVariables=function(){for(var t in this.curves){var e=this.curves[t];for(var a in this.parameters){var i=this.parameters[a];if(i.name==e.name){var r=e.curve.value(this.timestamp*e.speed%1);i.resource=[r[0],r[1],r[2]]}}}},MaterialShader.prototype.onDestroy=function(){this.cloneMaterial&&this.currentMaterial&&this.currentMaterial.destroy()},MaterialShader.prototype.onModelLoaded=function(t){},MaterialShader.prototype.onStateChange=function(t){this.reset()},MaterialShader.prototype.copy=function(t){var e=btoa(t);navigator.clipboard.writeText(e).then((function(){console.log("Async: Copying to clipboard was successful!")}),(function(t){console.error("Async: Could not copy text: ",t)}))},MaterialShader.prototype.addCodeEditor=function(){var t=this,e=document.createElement("button");e.style.position="fixed",e.style.left="10px",e.style.top="340px",e.style.width="100px",e.style.height="40px",e.style.zIndex="5000",e.style.background="rgba(0, 0, 0, 0.5)",e.style.color="#fff",e.textContent="Copy",e.onclick=function(){t.copy(t.emissiveCode.value)},document.body.appendChild(e);var a=document.createElement("textarea");a.style.position="fixed",a.style.left="10px",a.style.top="10px",a.style.width="400px",a.style.height="300px",a.style.padding="10px",a.style.zIndex="5000",a.style.background="rgba(0, 0, 0, 0.5)",a.style.outline="none",a.style.color="white",a.onkeyup=this.onShaderChange.bind(this);var i=document.createElement("style");i.innerText="#application-console{max-height: 80px;}",document.body.appendChild(i),this.emissiveCode=a,this.emissiveCode.value=atob(this.shader),this.emissive=this.emissiveCode.value,this.updateMaterial(),document.body.appendChild(a)},MaterialShader.prototype.onShaderChange=function(){Timer.clearTimeout(this.timer),this.timer=Timer.setTimeout((function(t){t.emissive=t.emissiveCode.value,t.updateMaterial()}),100,this)},MaterialShader.prototype.reset=function(){},MaterialShader.prototype.line=function(t){return t+"\n"},MaterialShader.prototype.number=function(t){return parseFloat(t).toFixed(2)},MaterialShader.prototype.colorRGB=function(t){return"vec3("+this.number(t.data[0])+", "+this.number(t.data[1])+", "+this.number(t.data[2])+")"},MaterialShader.prototype.colorRGBA=function(t){return"vec4("+this.number(t.data[0])+", "+this.number(t.data[1])+", "+this.number(t.data[2])+", "+this.number(t.data[3])+")"},MaterialShader.prototype.addParameter=function(t,e){var a="";for(var i in this[t]){var r=this[t][i],s=!1;if(a+=this.line("uniform "+e+" "+r.name+";"),"textures"==t&&(s=r.texture.resource),"colors"==t&&(s=r.color.data),"vectors"==t&&(s=r.vector.data),"curves"==t){var o=r.curve.value(this.timestamp*r.speed);s=[o[0],o[1],o[2]]}"numbers"==t&&(s=r.number),this.parameters.push({name:r.name,resource:s})}return a},MaterialShader.prototype.generateShaderOutput=function(){var t="";return t+=this.addParameter("textures","sampler2D"),t+=this.addParameter("colors","vec4"),t+=this.addParameter("vectors","vec2"),t+=this.addParameter("numbers","float"),t+=this.addParameter("curves","vec3"),t+=this.line("uniform float timestamp;"),t+=this.line("uniform float alpha_ref;"),t+=this.line("vec4 color  = vec4(0.0);"),t+=this.line("vec3 vertex = vec3(0.0);"),t+=this.line(this.emissive),t+=this.line("void getEmission() {"),t+=this.line("}"),t+=this.line("void getAlbedo() {"),t+=this.line("}"),t+=this.line("void getOpacity() {"),t+=this.line("}"),t+=this.line("void alphaTest(float a) {"),t+=this.line("if (a < alpha_ref) discard;"),t+=this.line("}")},MaterialShader.prototype.onAttributeChange=function(){this.reset(),this.updateMaterial()},MaterialShader.prototype.generateTransformOutput=function(){var t="";return t+=this.addParameter("textures","sampler2D"),t+=this.addParameter("colors","vec4"),t+=this.addParameter("vectors","vec2"),t+=this.addParameter("numbers","float"),t+=this.addParameter("curves","vec3"),this.isBatched&&(t+=this.line("#define DYNAMICBATCH")),t+=this.line("uniform float timestamp;"),t+=this.line("uniform mat4 matrix_viewInverse;"),t+=this.line("mat4 getModelMatrix() {"),t+=this.line("#ifdef DYNAMICBATCH"),t+=this.line("return getBoneMatrix(vertex_boneIndices);"),t+=this.line("#elif defined(INSTANCING)"),t+=this.line("return mat4(instance_line1, instance_line2, instance_line3, instance_line4);"),t+=this.line("#else"),t+=this.line("return matrix_model;"),t+=this.line("#endif"),t+=this.line("}"),t+=this.line("vec4 color  = vec4(0.0);"),t+=this.line("vec3 vertex = vec3(0.0);"),t+=this.line(this.emissive),t+=this.line("vec4 getPosition() {"),t+=this.line("dModelMatrix = getModelMatrix();"),t+=this.line("vec3 localPos = vertex_position;"),t+=this.line("vec4 posW   = dModelMatrix * vec4(localPos, 1.0);"),t+=this.line("vec2 UV     = localPos.xy * 0.5 + vec2(0.5, 0.5);"),this.billboard&&(t+=this.line("vec3 CameraUp_worldspace = matrix_viewInverse[1].xyz;"),t+=this.line("vec3 CameraRight_worldspace = matrix_viewInverse[0].xyz;"),t+=this.line("vec3 particleCenter_wordspace = ( dModelMatrix * vec4(0.0, 0.0, 0.0, 1.0) ).xyz;"),t+=this.line("posW.xyz = particleCenter_wordspace.xyz + CameraRight_worldspace * localPos.x + CameraUp_worldspace * localPos.y;")),this.vertexSet?t+=this.line("posW.xyz = getFullVertex(localPos, posW.xyz, UV, dModelMatrix, matrix_viewInverse);"):t+=this.line("posW.xyz+= getVertex(localPos, posW.xyz, UV);"),t+=this.line("dPositionW = posW.xyz;"),t+=this.line("vec4 outputPosition = matrix_viewProjection * posW;"),t+=this.line("return outputPosition;"),t+=this.line("}"),t+=this.line("vec3 getWorldPosition() {"),t+=this.line("return dPositionW;"),t+=this.line("}")},MaterialShader.prototype.getMaterialByBatch=function(){var t=this.entity.model.batchGroupId,e=this.app.batcher.getBatches(t);for(var a in e){var i=e[a].meshInstance.material;this.currentMaterial=i}},MaterialShader.prototype.updateMaterial=function(){if(this.timestamp=0,!this.currentMaterial)return!1;this.transform&&(this.currentMaterial.chunks.transformVS=this.generateTransformOutput()),this.color&&(this.currentMaterial.chunks.diffusePS=this.generateShaderOutput(),this.currentMaterial.chunks.opacityPS=" ",this.currentMaterial.chunks.emissivePS=" ",this.currentMaterial.chunks.alphaTestPS=" ",this.currentMaterial.chunks.endPS="vec4 outputColor = getColor(vUv0);",this.currentMaterial.chunks.endPS+="dAlpha = outputColor.a;",this.currentMaterial.chunks.endPS+="if (dAlpha < "+this.alphaRef+"){ discard; }",this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = outputColor.rgb;",this.currentMaterial.chunks.outputAlphaPS=" ",this.light&&(this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = mix(gl_FragColor.rgb * dDiffuseLight, dSpecularLight + dReflection.rgb * dReflection.a, dSpecularity);",this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = addFog(gl_FragColor.rgb);",this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = toneMap(gl_FragColor.rgb);",this.currentMaterial.chunks.endPS+="gl_FragColor.rgb = gammaCorrectOutput(gl_FragColor.rgb);"),this.currentMaterial.chunks.endPS+="gl_FragColor.a = dAlpha;"),this.currentMaterial.update()},MaterialShader.prototype.update=function(t){if(this.currentMaterial){if(this.updateDynamicVariables(),!this.isStatic||!this.once){for(var e in this.parameters){var a=this.parameters[e];this.currentMaterial.setParameter(a.name,a.resource)}this.once=!0}this.currentMaterial.setParameter("timestamp",this.timestamp),this.currentMaterial.update()}this.isPlaying&&(this.timestamp+=t,!this.continuous&&this.timestamp>=1&&(this.timestamp=1,this.isPlaying=!1))};var Overlay=pc.createScript("overlay");Overlay.attributes.add("killText",{type:"entity"}),Overlay.attributes.add("playerEntity",{type:"entity"}),Overlay.attributes.add("deathScreen",{type:"entity"}),Overlay.attributes.add("closestEnemies",{type:"entity"}),Overlay.attributes.add("alertMessage",{type:"entity"}),Overlay.attributes.add("cameraEntity",{type:"entity"}),Overlay.attributes.add("settingsButton",{type:"entity"}),Overlay.attributes.add("usernameButton",{type:"entity"}),Overlay.attributes.add("usernameInputEntity",{type:"entity"}),Overlay.prototype.initialize=function(){this.killCount=0,this.app.on("Overlay:Sound",this.playSound,this),this.app.on("Overlay:Kill",this.increaseKill,this),this.app.on("Overlay:Death",this.onDeath,this),this.app.on("Overlay:Damage",this.onDamage,this),this.app.on("Overlay:Heal",this.onHeal,this),this.app.on("Overlay:Alert",this.onAlert,this),this.app.on("Overlay:OpenLink",this.onOpenLink,this),this.usernameInputEntity.on("uiinput:updatevalue",this.changeUsername,this),this.app.on("Player:RespawnWithReward",this.onRespawnWithAds,this),Utils.isMobile()?this.closestEnemies.enabled=!1:document.addEventListener("pointerlockchange",this.lockStateChange.bind(this),!1)},Overlay.prototype.lockStateChange=function(){this.settingsButton.enabled=!pc.Mouse.isPointerLocked(),this.usernameButton.enabled=!pc.Mouse.isPointerLocked()},Overlay.prototype.onOpenLink=function(t){window.open(t,"_blank")},Overlay.prototype.changeUsername=function(t){pc.app.fire("Player:ChangeUsername",t)},Overlay.prototype.onAlert=function(t){this.alertMessage.element.text=t,this.app.fire("PopupManager:Show","Message")},Overlay.prototype.onHeal=function(){this.app.fire("Timeline:Heal")},Overlay.prototype.onDeath=function(){this.deathScreen.enabled=!0,this.entity.sound.play("Death"),this.cameraEntity.script.blackWhite.enabled=!0,pc.hasActiveInterface=!0,PokiPlugin.onPause(),setTimeout((function(t){t.doSpawn()}),2e3,this)},Overlay.prototype.onRespawnWithAds=function(){PokiPlugin.showReward((function(t){t?pc.app.fire("Money:Add",100):console.log("reward failed"),pc.app.fire("Player:Respawn")}))},Overlay.prototype.onRespawn=function(){var t=this;PokiPlugin.showMidroll((function(e){t.doSpawn()}))},Overlay.prototype.doSpawn=function(){this.deathScreen.enabled=!1,this.cameraEntity.script.blackWhite.enabled=!1,this.killCount=0,this.killText.element.text=this.killCount+"",pc.hasActiveInterface=!1,pc.app.fire("Player:Respawn"),PokiPlugin.isSatisfied=!0,PokiPlugin.checkSatisfaction()?(PokiPlugin.showConditionedMidroll(),Utils.addEvent("conditioned_midroll")):PokiPlugin.onPlay()},Overlay.prototype.increaseKill=function(t){if(t!=this.playerEntity)return!1;this.killCount++,this.killText.element.text=this.killCount+""},Overlay.prototype.playSound=function(t){this.entity.sound.play(t)};var Mount=pc.createScript("mount");pc.isGameReady=!1,Mount.prototype.initialize=function(){setTimeout((function(){pc.app.fire("Mount:Ready"),pc.isGameReady=!0}),60)};var Player=pc.createScript("player");Player.attributes.add("cursorEntity",{type:"entity"}),Player.attributes.add("shipEntity",{type:"entity"}),Player.attributes.add("directionEntity",{type:"entity"}),Player.attributes.add("shootPoint",{type:"entity"}),Player.attributes.add("cannonText",{type:"entity"}),Player.attributes.add("cannonReloadEntity",{type:"entity"}),Player.attributes.add("minimapPlayer",{type:"entity"}),Player.attributes.add("minimapScale",{type:"number",default:1}),Player.attributes.add("touchEntity",{type:"entity"}),Player.attributes.add("touchStartEntity",{type:"entity"}),Player.attributes.add("touchMoveEntity",{type:"entity"}),Player.attributes.add("touchDirectionEntity",{type:"entity"}),Player.attributes.add("touchFire",{type:"entity"}),Player.attributes.add("defaultControllerPositionEntity",{type:"entity"}),Player.attributes.add("enemyManager",{type:"entity"}),Player.attributes.add("mobileAutoShoot",{type:"entity"}),Player.attributes.add("mobileShootCursor",{type:"entity"}),Player.attributes.add("banditsEntity",{type:"entity"}),Player.prototype.initialize=function(){this.spawnPositions=this.app.root.findByTag("SpawnPoint"),this.entity.on("SetDamage",this.setDamage,this),this.app.on("Player:ChangeUsername",this.changeUsername,this)},Player.prototype.postInitialize=function(){var t=Utils.getItem("Username");this.entity.health=100,this.entity.maxHealth=100,this.entity.username=t||"Guest 7",this.entity.active=!0,this.entity.score=0,this.entity.symbol0=Utils.getItemAsNumber("symbol0",14),this.entity.symbol1=Utils.getItemAsNumber("symbol1",23),this.entity.color0=new pc.Color(.5,.5,.5),this.entity.color1=new pc.Color(1,1,1);var i=Utils.getItemAsArray("color0");i&&(this.entity.color0.r=i.r,this.entity.color0.g=i.g,this.entity.color0.b=i.b);var e=Utils.getItemAsArray("color1");e&&(this.entity.color1.r=e.r,this.entity.color1.g=e.g,this.entity.color1.b=e.b),this.maxCannon=30,this.currentCannon=parseInt(this.maxCannon+""),this.updateCannonText(),this.lastShoot=-1,this.direction=0,this.distance=1,this.isUncorrectStart=!1,Utils.isMobile()?this.initializeTouch():(this.app.mouse&&(this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this)),this.mobileAutoShoot.enabled=!1),this.entity.on("Damage",this.getDamage,this),this.entity.on("Heal",this.onHeal,this),this.entity.on("Level",this.setLevel,this),this.app.on("Player:Respawn",this.onRespawn,this),this.cannons=[],this.app.on("Player:AddCannon",this.addCannon,this),this.app.on("Player:Score",this.addScore,this),this.app.on("Player:RemoveCannon",this.removeCannon,this),this.entity.on("Ship:Shoot",this.doShoot,this),this.entity.fire("Flag")},Player.prototype.setDamage=function(t){this.shipEntity.script.ship.damage=t},Player.prototype.changeUsername=function(t){if(!t||0==t.length)return!1;this.entity.username=t,this.entity.fire("Label:Update"),Utils.setItem("Username",this.entity.username),pc.app.fire("PopupManager:Hide")},Player.prototype.setLevel=function(t){this.entity.level=t,1==t&&(this.entity.health=100,this.entity.maxHealth=100),2==t&&(this.entity.health=250,this.entity.maxHealth=250),3==t&&(this.entity.health=300,this.entity.maxHealth=300),t>=5&&(this.entity.health=500,this.entity.maxHealth=500),t>=8&&(this.entity.health=850,this.entity.maxHealth=850)},Player.prototype.addCannon=function(t){this.cannons.push(t)},Player.prototype.addScore=function(t){this.entity.score+=t},Player.prototype.removeCannon=function(t){this.cannons.splice(this.cannons.indexOf(t),1)},Player.prototype.scanCannons=function(){var t=this.entity.getPosition().clone(),i=this.cannons.length;for(this.entity.sound.slots.Alarm.volume=0;i--;){var e=this.cannons[i];if(e&&e.ownerEntity!=this.entity){var n=e.getPosition().clone(),o=Utils.distance(t.x,t.z,n.x,n.z);o<6&&(this.entity.sound.slots.Alarm.volume=Math.min((6-o)/6,1))}}},Player.prototype.onRespawn=function(){this.entity.setPosition(Utils.getRandom(this.spawnPositions).getPosition().clone()),this.entity.health=100,this.entity.enabled=!0,this.cursorEntity.enabled=!0,this.entity.collision.enabled=!0,this.entity.fire("Respawn")},Player.prototype.onHeal=function(){this.entity.health=parseInt(this.entity.maxHealth+""),this.updateHealth(),this.app.fire("Overlay:Heal")},Player.prototype.getDamage=function(t,i){if(!this.entity.active)return!1;this.app.fire("DealtDamage:Trigger",t,this.entity.getPosition()),this.entity.health-=t,this.updateHealth(i),this.app.fire("Motion","BigShake"),this.app.fire("Overlay:Damage"),this.entity.sound.play("Damage"),this.entity.health<40&&this.app.fire("ItemManager:SpawnHealthPack")},Player.prototype.updateHealth=function(t){this.entity.health<=0&&this.death(t)},Player.prototype.death=function(t){this.app.fire("Overlay:Death",t),this.app.fire("ShootingManager:Death"),this.app.fire("Money:LoseMoney"),this.entity.fire("Death"),this.cursorEntity.enabled=!1,this.entity.collision.enabled=!1,this.entity.score=0,this.app.fire("Money:Pay",10,this.entity.getPosition())},Player.prototype.onMouseMove=function(t){window.innerWidth,window.innerHeight;var i=this.entity.getPosition(),e=this.cursorEntity.getPosition();this.direction=Utils.lookAt(i.x,i.z,e.x,e.z),this.distance=Utils.distance(i.x,i.z,e.x,e.z),this.shipEntity.fire("Ship:Steer",this.direction),this.shipEntity.fire("Ship:Speed",this.distance),this.shipEntity.fire("Ship:ShootDirection",this.direction),PokiPlugin.firstGameplayEvent()},Player.prototype.reload=function(){if(this.cannonReloadEntity.enabled)return!1;this.cannonReloadEntity.enabled=!0,this.entity.sound.play("Reload"),setTimeout((function(t){t.cannonReloadEntity.enabled=!1,t.currentCannon=parseInt(t.maxCannon+""),t.updateCannonText()}),2e3,this)},Player.prototype.updateCannonText=function(){this.cannonText.element.text=this.currentCannon+" / "+this.maxCannon},Player.prototype.onMouseDown=function(){if(pc.hasActiveInterface)return!1;this.doShoot()},Player.prototype.doShoot=function(){return!(Date.now()-this.lastShoot<500)&&(this.currentCannon<=0?(this.reload(),!1):(this.shipEntity.fire("Ship:Shoot",this.shootPoint.getPosition(),this.direction,this.distance),this.currentCannon--,this.updateCannonText(),this.shipEntity.fire("Motion:Play","Shoot"),this.shipEntity.sound.play("Cannon"),this.entity.fire("Cursor:Attack"),this.currentCannon<=0&&this.reload(),void(this.lastShoot=Date.now())))},Player.prototype.updateMiniMap=function(){var t=this.entity.getPosition();this.minimapPlayer.setLocalEulerAngles(0,0,this.shipEntity.script.ship.currentAngle*pc.math.RAD_TO_DEG-180),this.minimapPlayer.setLocalPosition(t.x*this.minimapScale,-t.z*this.minimapScale,0)},Player.prototype.updateBandits=function(t){this.banditsEntity.setRotation(this.directionEntity.getRotation())},Player.prototype.update=function(t){this.scanCannons(),this.app.keyboard.wasPressed(pc.KEY_R)&&this.reload(),this.updateMiniMap(),this.setTouch(),this.updateBandits(),this.entity.active=!pc.hasActiveInterface},Player.prototype.initializeTouch=function(){this.isTouching=!1,this.touchEntity.enabled=!0,this.touchFire.enabled=!1,this.mobileAutoShoot.enabled=!0,this.defaultControllerPosition=this.defaultControllerPositionEntity.getPosition(),this.touchEntity.setPosition(this.defaultControllerPosition),this.touchDirectionEntity.enabled=!1,this.app.touch&&(this.app.on("TouchManager:LeftScreenStart",this.onTouchStart,this),this.app.on("TouchManager:LeftScreenMove",this.onTouchMove,this),this.app.on("TouchManager:LeftScreenEnd",this.onTouchEnd,this),this.app.on("TouchManager:RightScreenStart",this.doShoot,this)),this.touchStart=new pc.Vec2(0,0),this.currentTouch=new pc.Vec2(0,0)},Player.prototype.onTouchStart=function(t){if(pc.hasActiveInterface)return!1;var i=t;this.touchStart.x=i.x,this.touchStart.y=i.y,this.setTouchEntityPosition(),this.totalMouseDistance=0,this.touchDirectionEntity.enabled=!1,this.touchMoveEntity.setLocalPosition(0,0,0),this.isTouching=!0},Player.prototype.onTouchEnd=function(t){this.isTouching=!1,this.touchMoveEntity.setLocalPosition(0,0,0),this.touchEntity.setPosition(this.defaultControllerPosition),this.touchDirectionEntity.enabled=!1},Player.prototype.onTouchMove=function(t){if(pc.hasActiveInterface)return!1;if(this.isUncorrectStart)return!1;var i=t;this.currentTouch.x=i.x,this.currentTouch.y=i.y,this.isTouchMoved=!0;var e=this.currentTouch.x-this.touchStart.x,n=this.currentTouch.y-this.touchStart.y,o=75;if(e>o?e=o:e<-75&&(e=-75),n>o?n=o:n<-75&&(n=-75),this.touchMoveEntity.setLocalPosition(2*e,2*-n,0),this.totalMouseDistance=Utils.distance(this.touchStart.x,this.touchStart.y,this.currentTouch.x,this.currentTouch.y),this.touchMoveEntity.enabled=!0,this.totalMouseDistance>=o){var s=this.currentTouch.x-this.touchStart.x,a=this.currentTouch.y-this.touchStart.y,h=this.normalize(s,a),r=Math.min(Math.max(this.totalMouseDistance,0),o);this.touchStart.x=this.currentTouch.x-h.x*r,this.touchStart.y=this.currentTouch.y-h.y*r,this.setTouchEntityPosition()}},Player.prototype.setDirectionForAutoLock=function(){this.mobileAutoShoot.setLocalEulerAngles(0,this.direction*pc.math.RAD_TO_DEG,0),this.scanForEnemies()},Player.prototype.scanForEnemies=function(){for(var t=!1,i=this.enemyManager.script.enemyManager.enemies,e=i.length;e--;){var n=i[e];n.getPosition().clone().distance(this.mobileShootCursor.getPosition())<2.5&&(t=n.getPosition())}t?(this.cursorEntity.enabled=!0,this.cursorEntity.setPosition(t.clone()),this.doShoot()):this.cursorEntity.setPosition(0,-100,0)},Player.prototype.setTouch=function(){if(pc.hasActiveInterface)return!1;if(this.isTouching&&this.isTouchMoved){var t=Utils.lookAt(this.touchStart.x,this.touchStart.y,this.currentTouch.x,this.currentTouch.y);this.direction=t+Math.PI/4,this.setDirectionForAutoLock(),this.shipEntity.fire("Ship:Steer",this.direction),this.shipEntity.fire("Ship:ShootDirection",this.direction);var i=(-t+Math.PI/2)*pc.math.RAD_TO_DEG;this.touchDirectionEntity.setLocalEulerAngles(0,0,-i),this.touchDirectionEntity.enabled=this.totalMouseDistance>50}},Player.prototype.normalize=function(t,i){var e=Math.sqrt(t*t+i*i);return 0===e?{x:0,y:0}:{x:t/e,y:i/e}},Player.prototype.setTouchEntityPosition=function(){var t=this.app.graphicsDevice.canvas,i=this.touchStart.x/t.clientWidth*2-1,e=1-this.touchStart.y/t.clientHeight*2;this.touchEntity.setPosition(i,e,0)};var ShootingManager=pc.createScript("shootingManager");ShootingManager.attributes.add("cannonEntity",{type:"entity"}),ShootingManager.attributes.add("playerEntity",{type:"entity"}),ShootingManager.prototype.initialize=function(){this.lessDamageTimer=Date.now(),this.app.on("ShootingManager:Shoot",this.shoot,this),this.app.on("ShootingManager:Death",this.onDeath,this)},ShootingManager.prototype.onDeath=function(){this.lessDamageTimer=Date.now()},ShootingManager.prototype.shoot=function(t,n,a,e,o,i){var s=this.cannonEntity.clone();s.ownerEntity=t,s.setPosition(n),s.setEulerAngles(0,a*pc.math.RAD_TO_DEG,0),s.enabled=!0,s.script.cannon.damage=o,i>0&&(s.script.cannon.speed=i),t==this.playerEntity&&(s.script.cannon.speed=12),t!=this.playerEntity&&Date.now()-this.lessDamageTimer<6e4&&(s.script.cannon.damage*=.65),this.app.fire("EffectManager:ShootTrace",n,a),this.app.root.addChild(s)};var SimpleAi=pc.createScript("simpleAi");SimpleAi.attributes.add("shipEntity",{type:"entity"}),SimpleAi.attributes.add("shootPoint",{type:"entity"}),SimpleAi.attributes.add("mode",{type:"string",default:"Smart"}),SimpleAi.prototype.initialize=function(){this.waypoints=this.app.root.findByTag("Waypoint"),this.lastShootTime=Date.now(),this.lastScanTime=-1,this.enemies=[]},SimpleAi.prototype.scanTargets=function(){if(Date.now()-this.lastScanTime<1e3)return!1;var t=this,i=this.app.root.findByTag("AITarget");this.enemies=i.filter((function(i){return i!=t.entity}));for(var e=this.enemies.length;e--;){var n=this.enemies[e];n.distance=n.getPosition().sub(this.entity.getPosition()).length()}this.enemies.sort((function(t,i){return t.distance-i.distance})),this.lastScanTime=Date.now()},SimpleAi.prototype.focusTarget=function(t){if(Date.now()-this.lastFocusTime<2500)return!1;var i=t.getPosition().clone(),e=this.entity.getPosition().clone(),n=Utils.lookAt(e.x,e.z,i.x,i.z);this.shipEntity.fire("Ship:Steer",n),this.lastFocusTime=Date.now()},SimpleAi.prototype.findClosestWaypoint=function(t){if(Date.now()-this.lastWaypointSelection<1e3)return!1;for(var i=this.waypoints.length;i--;){var e=this.waypoints[i];e.distance=e.getPosition().sub(this.entity.getPosition()).length()}this.waypoints.sort((function(t,i){return t.distance-i.distance})),this.nextWaypoint=Utils.getRandom(this.waypoints.slice(0,3)),this.lastWaypointSelection=Date.now()},SimpleAi.prototype.shootEnemy=function(t){if(Date.now()-this.lastShootTime<1e3)return!1;if(!t)return!1;var i=t.findByName("Forward");if(!i)return!1;var e=this.entity.getPosition(),n=i.getPosition(),s=Utils.lookAt(e.x,e.z,n.x,n.z),o=0,a=0;"Stupid"==this.mode&&(o=.15*Math.random(),a=5e3*Math.random()),this.shipEntity.fire("Ship:Shoot",this.shootPoint.getPosition(),s+o,10),this.entity.sound.play("Shoot"),this.lastShootTime=Date.now()+a},SimpleAi.prototype.update=function(t){if(this.scanTargets(),this.findClosestWaypoint(),this.focusTarget(this.nextWaypoint),this.enemies.length>0){var i=Utils.getRandom(this.enemies.slice(0,3));i&&this.shootEnemy(i)}};var EnemyManager=pc.createScript("enemyManager");EnemyManager.attributes.add("enemyEntity",{type:"entity"}),EnemyManager.attributes.add("banditEntity",{type:"entity"}),EnemyManager.attributes.add("botCount",{type:"number",default:5}),EnemyManager.attributes.add("onlineText",{type:"entity"}),EnemyManager.attributes.add("symbols0",{type:"asset",array:!0}),EnemyManager.attributes.add("symbols1",{type:"asset",array:!0}),EnemyManager.attributes.add("flagColors",{type:"rgb",array:!0}),EnemyManager.prototype.postInitialize=function(){this.enemies=[],this.waypoints=this.app.root.findByTag("Waypoint"),this.usernameIndex=0,this.usernames=["Guest 12","Guest 15","Guest 01","Guest 20","Guest 33","Guest 03","Guest 13","Guest 14","Guest 15","Guest 16","Guest 17","Guest 18","Capn88","Beard13","SeaSerp42","Jolly","Storm","Scurvy90","Marauder18","Barnacle","Cannon","Gold","Salty","Buccaneer47","Skulllll","Mutinous23","Plunder68","bruh","ok","byeeee","eqwewq","sank","uuuuu","youtuber_brac","poki","looool","00000","pirate","arg","where","ddddddddddddd","121312312312","pfffff","team?",".....","----",":)",":D","2","x0x","xD bruh","aaaaaaaaaaa","xxxxx","noooo","TURKEY","Russ","--USA--","ld","huhkn","lisae","Eragon","venge","santi2317","Poke","JFIREXQC1!_3","skies","ratatatata","yuuuuuussss","Cicciogamer89","tim1000","MariaEmma","jaydencool412","cai","1337","Userplayer","daniel","Lucy","adelin","Fritz","Stishka","cem","meta","zonf","mirendra"],this.usernames=Utils.shuffle(this.usernames);for(var e=0;e<this.botCount;e++)this.createBot();this.app.on("EnemyManager:Death",this.onDeath,this)},EnemyManager.prototype.getRandomPosition=function(){return Utils.getRandom(this.waypoints).getPosition().clone()},EnemyManager.prototype.createBot=function(){var e=this,t=this.enemyEntity.clone();t.username=this.usernames[this.usernameIndex],t.level=this.getLevelByGameplay(),t.script.simpleAi.mode="Stupid",t.symbol0=this.parseFlagNumber(Utils.getRandom(this.symbols0).name),t.symbol1=this.parseFlagNumber(Utils.getRandom(this.symbols1).name),t.color0=Utils.getRandom(this.flagColors),t.color1=Utils.getRandom(this.flagColors),t.level>=5&&Math.random()>.8&&(t.script.simpleAi.mode="Crazy"),(Math.random()>.75||t.level>=7)&&this.createBandits(t),t.enabled=!0,t.setPosition(this.getRandomPosition()),this.usernameIndex++,this.usernameIndex>this.usernames.length-1&&(this.usernameIndex=0),t.on("destroy",(function(){e.enemies.splice(e.enemies.indexOf(this),1)})),this.entity.addChild(t),this.enemies.push(t)},EnemyManager.prototype.createBandits=function(e){var t=Math.round(3*Math.random()),a=e.findByTag("BanditPoint");if(e.banditIndex=0,t>0)for(var n=0;n<t;n++){var o=a[e.banditIndex];if(o){var i=this.banditEntity.clone();i.setPosition(o.getPosition()),i.script.bandit.ownerEntity=e,i.script.bandit.pointEntity=o,i.enabled=!0,this.app.root.addChild(i)}e.banditIndex++}},EnemyManager.prototype.parseFlagNumber=function(e){return parseInt(e.split("-")[1].split(".")[0])},EnemyManager.prototype.getLevelByGameplay=function(){var e=0;return pc.MoneyManager.money<=50&&Math.random()>.7&&(e=1),pc.MoneyManager.money>50&&(Math.random()>.7?e=1:Math.random()>.8&&(e=2)),pc.MoneyManager.money>250&&Math.random()>.7&&(e=3),pc.MoneyManager.money>500&&(Math.random()>.4&&(e=3),Math.random()>.8&&(e=4)),pc.MoneyManager.money>700&&(Math.random()>.2&&(e=4),Math.random()>.6&&(e=5)),pc.MoneyManager.money>1300&&(Math.random()>.4&&(e=6),Math.random()>.6&&(e=7)),pc.MoneyManager.money>2400&&(Math.random()>.4&&(e=8),Math.random()>.8&&(e=9)),e},EnemyManager.prototype.onDeath=function(){setTimeout((function(e){e.createBot()}),1e3+3e4*Math.random(),this)},EnemyManager.prototype.update=function(e){this.onlineText.element.text=this.enemies.length+10};var Button=pc.createScript("button");Button.attributes.add("action",{type:"string"}),Button.attributes.add("value",{type:"string"}),Button.attributes.add("cooldown",{type:"number",default:0}),Button.attributes.add("hoverStateEvent",{type:"boolean",default:!1}),Button.attributes.add("lockAfterAction",{type:"boolean",default:!1}),Button.attributes.add("hoverAction",{type:"string"}),Button.attributes.add("leaveAction",{type:"string"}),Button.attributes.add("hoverColor",{type:"rgb"}),Button.attributes.add("clickColor",{type:"rgb"}),Button.prototype.initialize=function(){this.cooldown>0&&(this.timerEntity=this.entity.findByName("Timer"),this.timerEntity.enabled=!1),this.entity.element.on("touchstart",this.onPress,this),this.entity.element.on("touchend",this.onLeave,this),this.entity.element.on("mouseenter",this.onHover,this),this.entity.element.on("mouseleave",this.onLeave,this),this.entity.element.on("mousedown",this.onPress,this),this.buttonUIParts=this.entity.findByTag("ButtonUI"),this.buttonUIParts.length>0&&(this.defaultColor=this.buttonUIParts[0].element.color.clone()),this.on("state",this.onStageChange,this)},Button.prototype.onStageChange=function(){this.lockAfterAction&&(this.entity.button.active=!0)},Button.prototype.onHover=function(t){document.body.style.cursor="pointer",this.hoverStateEvent&&this.app.fire(this.hoverAction,this.value),this.app.fire("Sound:Play","Button-Hover");for(var e=0;e<this.buttonUIParts.length;e++)this.buttonUIParts[e].element.color=this.hoverColor},Button.prototype.onLeave=function(t){this.hoverStateEvent&&this.app.fire(this.leaveAction,this.value),document.body.style.cursor="default";for(var e=0;e<this.buttonUIParts.length;e++)this.buttonUIParts[e].element.color=this.defaultColor},Button.prototype.onPress=function(t){var e=this;if(0===this.app.timeScale)return!1;if(this.timerEntity&&this.timerEntity.enabled)return!1;if(this.entity.button&&!this.entity.button.active)return!1;Utils.waitForChanges((function(){e.app.fire(e.action,e.value),e.entity.fire("Button:Click",e.action,e.value)})),this.timerEntity&&(this.timerEntity.enabled=!0);for(var i=0;i<this.buttonUIParts.length;i++)this.buttonUIParts[i].element.color=this.clickColor;Timer.setTimeout((function(t){for(var e=0;e<t.buttonUIParts.length;e++)t.buttonUIParts[e].element.color=t.defaultColor}),120,this),Timer.setTimeout((function(t){t.timerEntity&&(t.timerEntity.enabled=!1)}),1e3*this.cooldown,this),this.lockAfterAction&&(this.entity.button.active=!1,setTimeout((function(t){t.entity.button.active=!0}),1e3,this)),pc.lastClickTime=Date.now()};var Gameplay=pc.createScript("gameplay");Gameplay.attributes.add("pauseEntity",{type:"entity"}),Gameplay.attributes.add("playEntity",{type:"entity"}),Gameplay.attributes.add("lightEntity",{type:"entity"}),Gameplay.attributes.add("resetPopupEntity",{type:"entity"}),Gameplay.attributes.add("transitionEntity",{type:"entity"}),Gameplay.attributes.add("musicVolumeSlider",{type:"entity"}),Gameplay.attributes.add("gameVolumeSlider",{type:"entity"}),Gameplay.attributes.add("musicAsset",{type:"asset"}),Gameplay.prototype.initialize=function(){this.app.systems.sound.originalVolume=.4,this.app.systems.sound.volume=this.app.systems.sound.originalVolume,window.navigator.language&&(this.app.i18n.locale=this.app.i18n.findAvailableLocale(window.navigator.language));this.isPaused=!1,this.lastMidroll=Date.now(),this.gameVolume=Utils.getItemAsFloat("GameVolume",.5),this.gameVolumeSlider.scrollbar.value=this.gameVolume,this.gameVolumeSlider.scrollbar.on("set:value",this.updateVolumes,this),this.updateVolumes(),this.app.on("Gameplay:Pause",this.onPause,this),this.app.on("Gameplay:Play",this.onPlay,this),this.app.on("Gameplay:PausePlay",this.onPausePlay,this),this.app.on("Gameplay:Reset",this.onReset,this),this.app.on("Gameplay:ShowResetPopup",this.showResetPopup,this),this.app.on("Gameplay:CloseResetPopup",this.closeResetPopup,this)},Gameplay.prototype.afterGameplayStart=function(){var t=this;this.musicAsset.ready((function(){t.entity.sound.slots.Music.asset=t.musicAsset,t.entity.sound.play("Music")})),this.app.assets.load(this.musicAsset)},Gameplay.prototype.updateVolumes=function(){this.gameVolume=this.gameVolumeSlider.scrollbar.value,this.app.systems.sound.volume=this.gameVolume,Utils.setItem("GameVolume",this.gameVolume)},Gameplay.prototype.showResetPopup=function(){this.resetPopupEntity.enabled=!0},Gameplay.prototype.closeResetPopup=function(){this.resetPopupEntity.enabled=!1},Gameplay.prototype.onReset=function(){window.localStorage.clear(),window.location.reload()},Gameplay.prototype.onPausePlay=function(){this.isPaused?PokiPlugin.playGame():PokiPlugin.pauseGame()},Gameplay.prototype.onPause=function(){this.isPaused=!0,this.pauseEntity&&(this.pauseEntity.enabled=!this.isPaused,this.playEntity.enabled=this.isPaused)},Gameplay.prototype.onPlay=function(){this.isPaused=!1,this.pauseEntity&&(this.pauseEntity.enabled=!this.isPaused,this.playEntity.enabled=this.isPaused)},Gameplay.prototype.update=function(t){"undefined"!=typeof PokiPlugin&&PokiPlugin.tick(t)};pc.script.createLoadingScreen((function(e){var t,a;t=["body {","    background-color: #283538;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #283538;","}","","#application-splash {","    position: absolute;","    top: calc(50% - 28px);","    width: 264px;","    left: calc(50% - 132px);","}","","#application-splash img {","    width: 100%;","}","","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 2px;","    width: 100%;","    background-color: #1d292c;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #f60;","}","","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}"].join("\n"),(a=document.createElement("style")).type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),document.head.appendChild(a),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t),t.style.display="none";var a=document.createElement("img");a.src="https://playcanvas.com/static-assets/images/play_text_252_white.png",t.appendChild(a),a.onload=function(){t.style.display="block"};var o=document.createElement("div");o.id="progress-bar-container",t.appendChild(o);var p=document.createElement("div");p.id="progress-bar",o.appendChild(p)}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var t=document.getElementById("progress-bar");t&&(e=Math.min(1,Math.max(0,e)),t.style.width=100*e+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));var TextBackground=pc.createScript("textBackground");TextBackground.attributes.add("textEntity",{type:"entity"}),TextBackground.attributes.add("padding",{type:"number",default:10}),TextBackground.prototype.initialize=function(){},TextBackground.prototype.update=function(t){this.entity.element.width=this.textEntity.element.width+this.padding};var KillLog=pc.createScript("killLog");KillLog.attributes.add("notificationEntity",{type:"entity"}),KillLog.prototype.initialize=function(){this.notificationEntity.enabled=!1,this.app.on("KillLog:Add",this.addLog,this)},KillLog.prototype.addLog=function(t,i){var o=this.notificationEntity.clone();o.enabled=!0,o.findByName("Text").element.text='[color="#ffffff"]'+t+'[/color] killed [color="#ffffff"]'+i+"[/color]",this.entity.addChild(o),setTimeout((function(t){t.destroy()}),4e3,o)};var Leaderboard=pc.createScript("leaderboard");Leaderboard.attributes.add("playerEntity",{type:"entity"}),Leaderboard.attributes.add("leaderboardEntity",{type:"entity"}),Leaderboard.attributes.add("myPlayerColor",{type:"rgb"}),Leaderboard.prototype.initialize=function(){this.leaderboardEntity.enabled=!1,this.playerArray=[],this.lastCheck=Date.now(),this.scanLeaderboard()},Leaderboard.prototype.scanLeaderboard=function(e){if(Date.now()-this.lastCheck<1e3)return!1;for(var t=[],r=0,a=this.app.root.findByTag("Player"),n=a.length;n--;){(o=a[n])&&t.push({entity:o,username:o.username,score:o.score})}t.sort((function(e,t){return t.score-e.score}));for(n=t.length;n--;)if(t[n].entity===this.playerEntity){r=n+1;break}for(;this.playerArray.length;){(o=this.playerArray.pop()).destroy()}for(var i in t=t.slice(0,5)){var o,d=t[i];(o=this.leaderboardEntity.clone()).findByName("Username").element.text=parseInt(i)+1+". "+d.username,o.findByName("Score").element.text=d.score,o.enabled=!0,d.entity.kingIcon&&(0===parseInt(i)?d.entity.kingIcon.enabled=!0:d.entity.kingIcon.enabled=!1),d.entity==this.playerEntity&&(o.element.color=this.myPlayerColor),this.entity.addChild(o),this.playerArray.push(o)}r>5&&this.playerEntity.enabled&&((o=this.leaderboardEntity.clone()).element.color=this.myPlayerColor,o.findByName("Username").element.text=r+". "+this.playerEntity.username,o.findByName("Score").element.text=this.playerEntity.score,o.enabled=!0,this.entity.addChild(o),this.playerArray.push(o));this.lastCheck=Date.now()},Leaderboard.prototype.update=function(e){this.scanLeaderboard()};var ClosestEnemies=pc.createScript("closestEnemies");ClosestEnemies.attributes.add("groupEntity",{type:"entity"}),ClosestEnemies.attributes.add("playerEntity",{type:"entity"}),ClosestEnemies.prototype.initialize=function(){this.enemies=[],this.groupEntity.enabled=!1,this.app.on("Enemy:Add",this.onEnemyAdd,this),this.app.on("Enemy:Remove",this.onEnemyRemove,this)},ClosestEnemies.prototype.onEnemyAdd=function(e){var t=this.groupEntity.clone();t.enabled=!0,e.kingIcon=t.findByName("King"),e.arrow=t,t.kingIcon=e.kingIcon,this.entity.addChild(t),this.enemies.push(e)},ClosestEnemies.prototype.onEnemyRemove=function(e){var t=this.enemies.indexOf(e);t>-1&&(this.enemies.splice(t,1),e.arrow.destroy())},ClosestEnemies.prototype.update=function(e){for(var t=this.enemies.length;t--;){var i=this.enemies[t],n=i.arrow,s=this.playerEntity.getPosition(),o=i.getPosition(),a=Utils.distance(s.x,s.z,o.x,o.z);if(i&&a<30&&a>7){var l=Utils.lookAt(s.x,s.z,o.x,o.z);i.kingIcon.setLocalEulerAngles(0,0,-l*pc.math.RAD_TO_DEG+135),n.setLocalEulerAngles(0,0,l*pc.math.RAD_TO_DEG),n.enabled=!0}else n.enabled=!1}};var HealthPack=pc.createScript("healthPack");HealthPack.prototype.initialize=function(){this.entity.on("Trigger",this.onTrigger,this)},HealthPack.prototype.onTrigger=function(t){return!!t&&(-1!==t.tags.list().indexOf("Player")&&(t.fire("Heal"),void this.entity.destroy()))};var ItemManager=pc.createScript("itemManager");ItemManager.attributes.add("healthEntity",{type:"entity"}),ItemManager.attributes.add("randomHealthPackPoints",{type:"entity",array:!0}),ItemManager.prototype.initialize=function(){this.lastHealthPackSpawn=-1,this.lastSpawnAttempt=Date.now(),this.healthPackPoints=this.app.root.findByTag("HealthPack"),this.app.on("ItemManager:SpawnHealthPack",this.spawnHealthPack,this)},ItemManager.prototype.spawnHealthPack=function(){if(Date.now()-this.lastSpawnAttempt<5e3)return!1;var t=Utils.getRandom(this.randomHealthPackPoints);if(t){var a=t.getPosition().clone();if(!this.checkClosestHealthPacks(a)){var e=this.healthEntity.clone();e.setPosition(a),e.enabled=!0,this.entity.addChild(e)}}this.lastSpawnAttempt=Date.now()},ItemManager.prototype.spawnHealthPacks=function(){if(Date.now()-this.lastHealthPackSpawn<2e4)return!1;for(var t=0;t<this.healthPackPoints.length;t++){var a=this.healthPackPoints[t].getPosition();if(Math.random()>.5&&!this.checkClosestHealthPacks(a)){var e=this.healthEntity.clone();e.setPosition(a),e.enabled=!0,this.entity.addChild(e)}}this.lastHealthPackSpawn=Date.now()},ItemManager.prototype.checkClosestHealthPacks=function(t){for(var a=this.app.root.findByTag("HealthPackItem"),e=0;e<a.length;e++){if(a[e].getPosition().distance(t)<3)return!0}return!1},ItemManager.prototype.update=function(t){this.spawnHealthPacks()};var UpgradeManager=pc.createScript("upgradeManager");UpgradeManager.attributes.add("currentLevelImage",{type:"entity"}),UpgradeManager.attributes.add("nextLevelImage",{type:"entity"}),UpgradeManager.attributes.add("currentLevelText",{type:"entity"}),UpgradeManager.attributes.add("nextLevelText",{type:"entity"}),UpgradeManager.attributes.add("priceEntity",{type:"entity"}),UpgradeManager.attributes.add("levelPrices",{type:"number",array:!0}),UpgradeManager.attributes.add("damages",{type:"number",array:!0}),UpgradeManager.attributes.add("maxLevel",{type:"number",default:3}),UpgradeManager.attributes.add("playerEntity",{type:"entity"}),UpgradeManager.attributes.add("upgradeEntity",{type:"entity"}),UpgradeManager.attributes.add("upgradeWithAdsEntity",{type:"entity"}),UpgradeManager.attributes.add("upgradeIslandEntity",{type:"entity"}),UpgradeManager.attributes.add("messageEntity",{type:"entity"}),UpgradeManager.prototype.postInitialize=function(){this.lastUpgradeTime=-1,this.currentLevel=Utils.getItemAsNumber("Level",0),this.playerEntity.fire("Level",this.currentLevel),this.playerEntity.fire("SetDamage",this.damages[this.currentLevel]),this.app.on("PopupManager:Show",this.onPopupShow,this),this.app.on("UpgradeManager:Upgrade",this.doUpgrade,this),this.app.on("UpgradeManager:UpgradeWithAds",this.doUpgradeWithAds,this),this.app.on("UpgradeManager:UpgradeForFree",this.doUpgradeForFree,this),this.app.on("UpgradeManager:Reward",this.upgradeToReward,this),this.app.on("UpgradeManager:RemoveReward",this.removeReward,this)},UpgradeManager.prototype.onPopupShow=function(e){"Upgrades"==e&&this.onUpgrade()},UpgradeManager.prototype.doUpgradeWithAds=function(){var e=this;PokiPlugin.showReward((function(t){t?e.doUpgrade(!0):pc.app.fire("Overlay:Alert","You need to disable adblock!")}))},UpgradeManager.prototype.doUpgrade=function(e){if(this.currentLevel>=this.maxLevel)return!1;0==this.currentLevel&&(e=!0);var t=this.levelPrices[this.currentLevel];if(pc.MoneyManager.money<t&&!e)return this.app.fire("Overlay:Alert","You dont have enough money!"),!1;this.app.fire("Money:Remove",t),this.currentLevel++,this.playerEntity.fire("Level",this.currentLevel),this.playerEntity.fire("SetDamage",this.damages[this.currentLevel]),Utils.setItem("Level",this.currentLevel),this.entity.sound.play("Upgrade"),this.app.fire("PopupManager:Hide"),this.app.fire("GuideLine:Complete","FirstUpgrade"),this.lastUpgradeTime=Date.now()},UpgradeManager.prototype.onUpgrade=function(){this.currentLevelImage.element.textureAsset=this.app.assets.find("Ship-Thumbnail-Level-"+this.currentLevel+".png"),this.nextLevelImage.element.textureAsset=this.app.assets.find("Ship-Thumbnail-Level-"+(this.currentLevel+1)+".png"),this.currentLevelText.element.text="LVL "+(this.currentLevel+1),this.nextLevelText.element.text="LVL "+(this.currentLevel+2),this.priceEntity.element.text=this.levelPrices[this.currentLevel]+" GOLD",this.currentLevel>=this.maxLevel&&this.app.fire("Overlay:Alert","You are at max level!"),0==this.currentLevel&&(this.upgradeEntity.findByName("Gold").element.text="FREE"),Date.now()-this.lastUpgradeTime>5e4&&pc.MoneyManager.money<this.levelPrices[this.currentLevel]?(this.upgradeEntity.enabled=!1,this.upgradeWithAdsEntity.enabled=!0):(this.upgradeEntity.enabled=!0,this.upgradeWithAdsEntity.enabled=!1)},UpgradeManager.prototype.upgradeToReward=function(){this.playerEntity.fire("Level",this.maxLevel+1),this.playerEntity.fire("SetDamage",this.damages[this.maxLevel]),Utils.addEvent("Legendary_Ship_Unlocked"),this.messageEntity.element.text="You can't do this action!",this.upgradeIslandEntity.script.interaction.triggerName="Message"},UpgradeManager.prototype.removeReward=function(){this.playerEntity.fire("Level",this.currentLevel),this.playerEntity.fire("SetDamage",this.damages[this.currentLevel]),this.upgradeIslandEntity.script.interaction.triggerName="Upgrades"},UpgradeManager.prototype.update=function(){pc.MoneyManager.money>=this.levelPrices[this.currentLevel]?this.app.fire("GuideLine:SetObjective",this.upgradeIslandEntity):this.app.fire("GuideLine:SetObjective",!1)};var BakedPhysicsPlayer=pc.createScript("bakedPhysicsPlayer");BakedPhysicsPlayer.attributes.add("staticEntity",{type:"entity"}),BakedPhysicsPlayer.attributes.add("speed",{type:"number",default:1}),BakedPhysicsPlayer.attributes.add("lerp",{type:"number",default:.1}),BakedPhysicsPlayer.attributes.add("autoplay",{type:"boolean",default:!1}),BakedPhysicsPlayer.attributes.add("file",{type:"asset",assetType:"json"}),BakedPhysicsPlayer.attributes.add("soundPlay",{type:"boolean"}),BakedPhysicsPlayer.attributes.add("isLoaded",{type:"boolean",default:!1}),BakedPhysicsPlayer.prototype.initialize=function(){this.isLoaded?this._onModelLoaded(!0):this.staticEntity.on("Model:Loaded",this._onModelLoaded,this),this.on("state",this.onStateChange,this),this.on("destroy",this.onDestroy,this)},BakedPhysicsPlayer.prototype.onStateChange=function(t){!0===t?this.onPlay():this.onReset()},BakedPhysicsPlayer.prototype._onModelLoaded=function(t){!0===t&&this.onModelLoaded()},BakedPhysicsPlayer.prototype.onModelLoaded=function(){var t=this;this.isPlaying=!1,this.fps=60,this.pool=[],this.data={},this.frames=[],this.frameIndex=0,this.frameTime=0,this.isHidden=!1,this.childVertices=!1,this.childScale=!1,this.app.assets.load(this.file),this.file.ready((function(e){var i=this.resources[0];t.data=i,t.count=i.count,t.duration=i.duration,t.frames=i.frames,t.childVertices=i.childVertices,t.childScale=i.childScale,t.createPhysicalObjects(),t.hidePool()})),this.staticEntity.enabled=!1,this.app.on("BakedPhysics:"+this.entity.name,this.onPlay,this),this.autoplay&&this.app.fire("BakedPhysics:"+this.entity.name,new pc.Vec3(0,0,0))},BakedPhysicsPlayer.prototype.onDestroy=function(){this.app.off("BakedPhysics:"+this.entity.name,this.onPlay,this)},BakedPhysicsPlayer.prototype.onReset=function(){for(var t=this.pool.length;t--;){var e=this.frames[0][t],i=e,s=e[0];this.childVertices?(this.pool[s].node.setLocalPosition(100*i[1],100*i[2],100*i[3]),this.pool[s].node.setLocalEulerAngles(i[4],i[5],i[6])):(this.pool[s].setPosition(i[1],i[2],i[3]),this.pool[s].setLocalEulerAngles(i[4],i[5],i[6]))}},BakedPhysicsPlayer.prototype.onPlay=function(t){this.isPlaying=!0,this.isHidden=!1,this.isEnded=!1,this.frameIndex=0,this.frameTime=0,t&&this.entity.setLocalPosition(t),this.showPool(),this.soundPlay&&this.entity.sound.play("Sound")},BakedPhysicsPlayer.prototype.createPhysicalObjects=function(){if(this.data.childVertices){var t=this.staticEntity.model.meshInstances;for(var e in t){var i=t[e];parseInt(e)>-1&&(i.triggered=!1,i.isLarge=i.node.name.search("Large")>-1,this.pool.push(i))}}else{if(this.isAlreadyCreated)return!1;for(var s=0;s<this.count;s++){var a=this.staticEntity.clone();a.enabled=!0,this.pool.push(a),this.entity.addChild(a)}}this.isAlreadyCreated=!0},BakedPhysicsPlayer.prototype.showPool=function(t){if(this.childVertices)this.staticEntity.enabled=!0;else for(var e=this.pool.length;e--;)this.pool[e].enabled=!0;this.staticEntity.enabled=!0},BakedPhysicsPlayer.prototype.hidePool=function(t){if(this.isHidden)return!1;if(this.childVertices)for(var e=this.pool.length;e--;)this.pool[e].triggered=!1,this.pool[e].enabled=!1;else this.staticEntity.enabled=!1;this.staticEntity.enabled=!1,this.isHidden=!0},BakedPhysicsPlayer.prototype.onEnd=function(){if(this.isEnded)return!1;this.isEnded=!0},BakedPhysicsPlayer.prototype.getRadius=function(t){return t.x+t.y+t.z},BakedPhysicsPlayer.prototype.update=function(t){if(!this.isPlaying)return!1;if(0===this.frames.length)return!1;if(this.frames.length-1<this.frameIndex)return this.isPlaying=!1,this.hidePool(),this.onEnd(),!1;for(var e=this.pool.length;e--;){var i=this.frames[this.frameIndex][e],s=i,a=i[0];if(this.childVertices?(this.pool[a].node.setLocalPosition(100*s[1],100*s[2],100*s[3]),this.pool[a].node.setLocalEulerAngles(s[4],s[5],s[6])):(this.pool[a].getLocalPosition().lerp(this.pool[a].getLocalPosition(),new pc.Vec3(s[1],s[2],s[3]),this.lerp),this.pool[a].setLocalEulerAngles(s[4],s[5],s[6])),this.groundTrigger){var o=this.pool[a].node.getPosition().clone();!this.pool[a].triggered&&this.pool[a].isLarge&&o.y<0&&(this.pool[a].triggered=!0)}}this.frameTime+=t*this.fps*this.speed,this.frameIndex=Math.round(this.frameTime)};var ConnectedScene=pc.createScript("connectedScene");ConnectedScene.attributes.add("sceneEntity",{type:"entity"}),ConnectedScene.attributes.add("disableEntity",{type:"entity"}),ConnectedScene.prototype.initialize=function(){this.onStateChange(!0),this.on("state",this.onStateChange,this)},ConnectedScene.prototype.onStateChange=function(e){this.sceneEntity.enabled=e,this.disableEntity&&(this.disableEntity.enabled=!e)};var DesignFlag=pc.createScript("designFlag");DesignFlag.attributes.add("flagLayer0",{type:"entity"}),DesignFlag.attributes.add("flagLayer1",{type:"entity"}),DesignFlag.attributes.add("symbolLayer0",{type:"entity"}),DesignFlag.attributes.add("symbolLayer1",{type:"entity"}),DesignFlag.attributes.add("colorLayer0",{type:"entity"}),DesignFlag.attributes.add("colorLayer1",{type:"entity"}),DesignFlag.attributes.add("colors",{type:"rgb",array:!0}),DesignFlag.attributes.add("symbols",{type:"asset",array:!0}),DesignFlag.attributes.add("playerEntity",{type:"entity"}),DesignFlag.prototype.initialize=function(){this.colorIndex0=0,this.colorIndex1=10,this.symbolIndex0=7,this.symbolIndex1=23,this.app.on("DesignFlag:PrevColor",this.prevColor,this),this.app.on("DesignFlag:NextColor",this.nextColor,this),this.app.on("DesignFlag:PrevSymbol",this.prevSymbol,this),this.app.on("DesignFlag:NextSymbol",this.nextSymbol,this),this.app.on("DesignFlag:Save",this.onSave,this),this.updateFlagColor(0),this.updateFlagColor(1),this.updateFlagSymbol(0),this.updateFlagSymbol(1)},DesignFlag.prototype.onSave=function(){this.playerEntity.symbol0=this.getSymbolIndex(this.symbols[this.symbolIndex0].name),this.playerEntity.symbol1=this.getSymbolIndex(this.symbols[this.symbolIndex1].name),this.playerEntity.color0=this.colors[this.colorIndex0],this.playerEntity.color1=this.colors[this.colorIndex1],Utils.setItem("symbol0",this.playerEntity.symbol0),Utils.setItem("symbol1",this.playerEntity.symbol1),Utils.setItemAsArray("color0",{r:this.playerEntity.color0.r,g:this.playerEntity.color0.g,b:this.playerEntity.color0.b}),Utils.setItemAsArray("color1",{r:this.playerEntity.color1.r,g:this.playerEntity.color1.g,b:this.playerEntity.color1.b}),this.playerEntity.fire("Flag"),this.app.fire("PopupManager:Hide")},DesignFlag.prototype.getSymbolIndex=function(t){var e=t.split("-")[1];return e=e.split(".")[0]},DesignFlag.prototype.prevSymbol=function(t){this["symbolIndex"+t]--,this["symbolIndex"+t]<0&&(this["symbolIndex"+t]=this.symbols.length-1),this.updateFlagSymbol(t)},DesignFlag.prototype.nextSymbol=function(t){this["symbolIndex"+t]++,this["symbolIndex"+t]>this.symbols.length-1&&(this["symbolIndex"+t]=0),this.updateFlagSymbol(t)},DesignFlag.prototype.prevColor=function(t){this["colorIndex"+t]--,this["colorIndex"+t]<0&&(this["colorIndex"+t]=this.colors.length-1),this.updateFlagColor(t)},DesignFlag.prototype.nextColor=function(t){this["colorIndex"+t]++,this["colorIndex"+t]>this.colors.length-1&&(this["colorIndex"+t]=0),this.updateFlagColor(t)},DesignFlag.prototype.updateFlagColor=function(t){this["flagLayer"+t].element.color=this.colors[this["colorIndex"+t]],this["colorLayer"+t].element.color=this.colors[this["colorIndex"+t]],this["symbolLayer"+t].element.color=this.colors[this["colorIndex"+t]]},DesignFlag.prototype.updateFlagSymbol=function(t){this["symbolLayer"+t].element.textureAsset=this.symbols[this["symbolIndex"+t]],this["flagLayer"+t].element.textureAsset=this.symbols[this["symbolIndex"+t]]};var Mirror=pc.createScript("mirror");Mirror.attributes.add("playerEntity",{type:"entity"}),Mirror.attributes.add("modelEntity",{type:"entity"}),Mirror.prototype.initialize=function(){this.playerEntity.parent.on("Level",this.setLevel,this)},Mirror.prototype.setLevel=function(t){this.entity.model.asset=this.modelEntity.model.asset};var GoldReward=pc.createScript("goldReward");GoldReward.attributes.add("canBarrowEntity",{type:"entity"}),GoldReward.attributes.add("nowAllowedEntity",{type:"entity"}),GoldReward.attributes.add("playerEntity",{type:"entity"}),GoldReward.attributes.add("coinDisplay",{type:"entity"}),GoldReward.prototype.initialize=function(){this.lastReward=Date.now(),this.canBarrowEntity.enabled=!0,this.on("state",this.onStateChange,this),this.app.on("Money:WatchReward",this.onRewardWatch,this),this.app.on("GoldReward:Animation",this.playCoinAnimation,this)},GoldReward.prototype.onStateChange=function(t){t&&(Date.now()-this.lastReward<5e4?(this.canBarrowEntity.enabled=!1,this.nowAllowedEntity.enabled=!0):(this.nowAllowedEntity.enabled=!1,this.canBarrowEntity.enabled=!0))},GoldReward.prototype.playCoinAnimation=function(t){for(var a=0;a<30;a++)setTimeout((function(t){t.app.fire("World2Screen:Animate","Coin",t.playerEntity.getPosition().clone().add(new pc.Vec3(5*(Math.random()-Math.random()),5*(Math.random()-Math.random()),5*(Math.random()-Math.random()))),t.coinDisplay)}),100+100*a,this)},GoldReward.prototype.onRewardWatch=function(t){var a=this;this.app.mouse.disablePointerLock(),PokiPlugin.showReward((function(e){e?(pc.app.fire("PopupManager:Hide"),a.playCoinAnimation(),pc.app.fire("Money:Add",parseInt(t)),a.lastReward=Date.now()):pc.app.fire("Overlay:Alert","You need to disable adblock!")})),this.canBarrowEntity.enabled=!1,this.nowAllowedEntity.enabled=!0};var MiniMapMarker=pc.createScript("miniMapMarker");MiniMapMarker.attributes.add("iconEntity",{type:"entity"}),MiniMapMarker.attributes.add("mapScale",{type:"number",default:2}),MiniMapMarker.prototype.initialize=function(){this.clonedIconEntity=this.iconEntity.clone();var i=this.entity.getPosition().clone();this.clonedIconEntity.enabled=!0,this.clonedIconEntity.setLocalPosition(i.x*this.mapScale,-i.z*this.mapScale,0),this.iconEntity.parent.addChild(this.clonedIconEntity),this.entity.on("Minimap:ShowIcon",this.showIcon,this),this.entity.on("Minimap:HideIcon",this.hideIcon,this)},MiniMapMarker.prototype.showIcon=function(){this.clonedIconEntity.enabled=!0},MiniMapMarker.prototype.hideIcon=function(){this.clonedIconEntity.enabled=!1};var MobileUi=pc.createScript("mobileUi");MobileUi.attributes.add("position",{type:"vec3",default:[0,0,0]}),MobileUi.attributes.add("scale",{type:"vec3",default:[1,1,1]}),MobileUi.attributes.add("visible",{type:"boolean",default:!0}),MobileUi.prototype.initialize=function(){Utils.isMobile()&&(this.entity.enabled=this.visible,0==this.position.x&&0==this.position.y&&0==this.position.z||this.entity.setLocalPosition(this.position),1==this.scale.x&&1==this.scale.y&&1==this.scale.z||this.entity.setLocalScale(this.scale))};var ModelComponent=pc.createScript("modelComponent");ModelComponent.attributes.add("loaded",{type:"boolean",default:!1}),ModelComponent.prototype.initialize=function(){if(this.loaded)return clearTimeout(this.loadTimeout),this.loadTimeout=setTimeout((function(t){t.entity.fire("Model:Loaded",!0)}),1e3,this),!1;this.materialCount=0,this.materialLoaded=0;var t=this.entity.model.asset;if(!t)return!1;var e=this.app.assets.get(t),i=this;e.ready((function(){clearTimeout(i.loadTimeout),i.entity.fire("Model:Loaded",!1),i.checkMaterials()}))},ModelComponent.prototype.checkMaterials=function(){if(!this.entity.model)return!1;var t=this.entity.model.meshInstances,e=this;if(!t)return!1;for(var i in this.materialCount=t.length,t){var a=t[i].material,o=this.app.assets.find(a.name);if(!o)return!1;o.ready((function(){e.checkTextures(a)})),this.app.assets.load(o)}},ModelComponent.prototype.checkTextures=function(t){var e=t._assetReferences,i=0,a=0,o=this;for(var s in e){var n=e[s];a++,this.app.assets.load(n.asset),n.asset.ready((function(){++i>=a&&o.setMaterial()}))}0===a&&this.setMaterial()},ModelComponent.prototype.setMaterial=function(){this.materialLoaded++,this.materialCount==this.materialLoaded&&(clearTimeout(this.loadTimeout),this.entity.fire("Model:Loaded",!0))};var Bandit=pc.createScript("bandit");Bandit.attributes.add("ownerEntity",{type:"entity"}),Bandit.attributes.add("pointEntity",{type:"entity"}),Bandit.attributes.add("characterEntity",{type:"entity"}),Bandit.attributes.add("shootPoint",{type:"entity"}),Bandit.attributes.add("directionEntity",{type:"entity"}),Bandit.attributes.add("originEntity",{type:"entity"}),Bandit.attributes.add("speed",{type:"number",default:1}),Bandit.attributes.add("turnSpeed",{type:"number",default:.1}),Bandit.attributes.add("active",{type:"boolean",default:!0}),Bandit.attributes.add("damage",{type:"number",default:1}),Bandit.prototype.initialize=function(){this.currentAngle=0,this.nextAngle=0,this.identifier=.5*Math.random(),this.currentTarget=!1,this.lastTargetTime=Date.now(),this.lastShootingTime=Date.now(),this.force=new pc.Vec3(0,0,0),this.speedFactor=1,this.ownerEntity.on("Cursor:Target",this.setTarget,this),this.ownerEntity.on("Cursor:Attack",this.doAttack,this),this.ownerEntity.on("destroy",this.onOwnerDestroy,this),this.entity.on("Bandit:Set",this.setByStyle,this)},Bandit.prototype.onOwnerDestroy=function(){"Player"!==this.ownerEntity.name&&(console.log("owner died :("),this.entity.destroy())},Bandit.prototype.setByStyle=function(t){this.characterEntity.findByTag("Style").forEach((function(t){t.enabled=!1})),this.characterEntity.findByName(t.body).enabled=!0,this.characterEntity.findByName(t.hat).enabled=!0},Bandit.prototype.setTarget=function(t){this.currentTarget=t},Bandit.prototype.doAttack=function(){this.lastTargetTime=Date.now(),this.speedFactor=1.05},Bandit.prototype.checkTarget=function(){return!!(this.currentTarget&&this.currentTarget.parent&&Date.now()-this.lastTargetTime<1500)&&this.currentTarget},Bandit.prototype.followOwner=function(){var t=this.entity.getPosition(),e=this.pointEntity.getPosition();this.nextAngle=Utils.lookAt(t.x,t.z,e.x,e.z)},Bandit.prototype.attackTarget=function(){if(!this.currentTarget)return!1;var t=this.entity.getPosition(),e=this.currentTarget.getPosition();this.nextAngle=Utils.lookAt(t.x,t.z,e.x,e.z)+this.identifier,this.doShoot()},Bandit.prototype.doShoot=function(){if(Date.now()-this.lastShootingTime<1e3)return!1;this.app.fire("ShootingManager:Shoot",this.ownerEntity,this.shootPoint.getPosition(),this.nextAngle,1,this.damage,10),this.originEntity.fire("Motion","Shoot"),this.lastShootingTime=Date.now()},Bandit.prototype.updateDirection=function(t){this.currentAngle=Utils.rotate(this.currentAngle,this.nextAngle,this.turnSpeed*t*60),this.directionEntity.setLocalEulerAngles(0,this.currentAngle*pc.math.RAD_TO_DEG,0)},Bandit.prototype.applyForce=function(t){if(!this.active)return!1;this.force.x=Math.sin(this.currentAngle)*this.speed*this.speedFactor*t,this.force.z=Math.cos(this.currentAngle)*this.speed*this.speedFactor*t;var e=this.entity.getPosition(),i=this.ownerEntity.getPosition(),n=Utils.lookAt(e.x,e.z,i.x,i.z);Utils.distance(e.x,e.z,i.x,i.z)<3&&(this.force.x-=Math.sin(n)*t*3,this.force.z-=Math.cos(n)*t*3),this.entity.translate(this.force)},Bandit.prototype.update=function(t){this.checkTarget()?this.attackTarget():this.followOwner(),this.speedFactor=pc.math.lerp(this.speedFactor,1,.1),this.updateDirection(t),this.applyForce(t)};var GuideLine=pc.createScript("guideLine");GuideLine.attributes.add("lineEntity",{type:"entity"}),GuideLine.prototype.initialize=function(){this.currentObjective=!1,this.app.on("GuideLine:SetObjective",this.setObjective,this)},GuideLine.prototype.setObjective=function(t){this.currentObjective=t},GuideLine.prototype.update=function(t){if(this.currentObjective){var e=this.entity.getPosition(),i=this.currentObjective.getPosition(),n=Utils.lookAt(e.x,e.z,i.x,i.z),s=Utils.distance(e.x,e.z,i.x,i.z);this.lineEntity.enabled=!(s<10),this.lineEntity.setLocalEulerAngles(0,n*pc.math.RAD_TO_DEG-90,0)}else this.lineEntity.enabled=!1};var BanditManager=pc.createScript("banditManager");BanditManager.attributes.add("points",{type:"entity",array:!0}),BanditManager.attributes.add("banditEntity",{type:"entity"}),BanditManager.attributes.add("playerEntity",{type:"entity"}),BanditManager.attributes.add("characterEntity",{type:"entity"}),BanditManager.attributes.add("nameEntity",{type:"entity"}),BanditManager.attributes.add("typeEntity",{type:"entity"}),BanditManager.attributes.add("hpEntity",{type:"entity"}),BanditManager.attributes.add("levelEntity",{type:"entity"}),BanditManager.attributes.add("salaryEntity",{type:"entity"}),BanditManager.attributes.add("rewardCount",{type:"entity"}),BanditManager.attributes.add("rewardCountBar",{type:"entity"}),BanditManager.attributes.add("rewardIcon",{type:"entity"}),BanditManager.attributes.add("bandits",{type:"json",schema:[{name:"name",type:"string"},{name:"type",type:"string",default:"Sea Reavers"},{name:"level",type:"number",default:1},{name:"salary",type:"number",default:50},{name:"health",type:"number",default:100},{name:"body",type:"string",default:"Pirate 1"},{name:"hat",type:"string",default:"Pirate head 1"}],array:!0}),BanditManager.prototype.initialize=function(){this.watchedAds=0,this.amountOfAds=1,this.currentIndex=0,this.currentBandit=!1,this.savedBandits=Utils.getItemAsArray("Bandits"),this.loadBandits(),this.banditEntity.enabled=!1,this.app.on("BanditManager:Buy",this.buyBandit,this),this.app.on("BanditManager:Set",this.setBandit,this)},BanditManager.prototype.setBandit=function(t){var a=t.name,e=this.getBanditByName(a);this.currentBandit=e,e&&(this.characterEntity.findByTag("Style").forEach((function(t){t.enabled=!1})),this.characterEntity.findByName(e.body).enabled=!0,this.characterEntity.findByName(e.hat).enabled=!0,this.nameEntity.element.text=e.name,this.typeEntity.element.text=e.type,this.hpEntity.element.text=e.health+" / "+e.health,this.levelEntity.element.text=e.level+" lvl",this.salaryEntity.element.text=e.salary+" gold",this.savedBandits.length>0&&(this.rewardIcon.enabled=!0,this.rewardCount.element.text=this.watchedAds+" / "+this.amountOfAds,this.rewardCountBar.enabled=!0))},BanditManager.prototype.buyBandit=function(){if(!this.points[this.currentIndex])return this.app.fire("Overlay:Alert","You can't hire more bandit for your crew!"),!1;if(this.savedBandits.length<=0)return this.doBuyBandit(this.currentBandit.name),pc.app.fire("BanditIsland:Buy"),!1;var t=this;PokiPlugin.showReward((function(a){a?(t.watchedAds+=1,Utils.addEvent("Bandit_Unlock_"+t.currentBandit.name+"_Ads_"+t.watchedAds),t.watchedAds>=t.amountOfAds&&(Utils.addEvent("Bandit_Unlock_"+t.currentBandit.name+"_Completed"),t.doBuyBandit(t.currentBandit.name),t.watchedAds=0,t.amountOfAds+=1,pc.app.fire("BanditIsland:Buy")),t.updateAmountOfWatchedAds()):pc.app.fire("Overlay:Alert","You need to disable adblock!")}))},BanditManager.prototype.updateAmountOfWatchedAds=function(){this.rewardCount.element.text=this.watchedAds+" / "+this.amountOfAds,this.rewardCountBar.findByName("Fill").script.timeline.endFrame.scale.x=this.watchedAds/this.amountOfAds,this.rewardCountBar.findByName("Fill").fire("Timeline")},BanditManager.prototype.doBuyBandit=function(t){this.createBandit(t),this.savedBandits.push(t),Utils.setItemAsArray("Bandits",this.savedBandits),this.app.fire("PopupManager:Hide")},BanditManager.prototype.createBandit=function(t){var a=this.banditEntity.clone(),e=this.points[this.currentIndex];a.setPosition(e.getPosition()),a.script.bandit.playerEntity=this.playerEntity,a.script.bandit.pointEntity=e,a.enabled=!0,this.app.root.addChild(a),a.fire("Bandit:Set",this.getBanditByName(t)),this.currentIndex++},BanditManager.prototype.loadBandits=function(){for(var t=this.savedBandits.length;t--;)this.createBandit(this.savedBandits[t])},BanditManager.prototype.getBandit=function(){return Utils.getRandom(this.bandits)},BanditManager.prototype.getBanditByName=function(t){for(var a=this.bandits.length;a--;)if(this.bandits[a].name===t)return this.bandits[a]};var TouchManager=pc.createScript("touchManager");TouchManager.attributes.add("screenSplitValue",{type:"number",default:2,description:"1.5 makes left screen part bigger, 2.5 makes right side bigger"}),TouchManager.prototype.initialize=function(){this.setController()},TouchManager.prototype.setController=function(){if(!this.app.touch)return!1;this.movementTouchID=-1,this.rotationTouchID=-1,this.app.touch.on("touchstart",this.onTouchStart,this),this.app.touch.on("touchmove",this.onTouchMove,this),this.app.touch.on("touchend",this.onTouchEnd,this)},TouchManager.prototype.onTouchStart=function(t){var e=t.touches;if(e||(e=[t]),e.length>0)for(i=0;i<e.length;i++){var o=e[i];o.x<this.app.graphicsDevice.canvas.width/this.screenSplitValue?-1==this.movementTouchID&&(this.movementTouchID=o.id,this.app.fire("TouchManager:LeftScreenStart",o)):-1==this.rotationTouchID&&(this.rotationTouchID=o.id,this.app.fire("TouchManager:RightScreenStart",o))}},TouchManager.prototype.onTouchMove=function(t){var e=t.touches;if(e||(e=[t]),e.length>0)for(i=0;i<e.length;i++){var o=e[i];o.id==this.movementTouchID?this.app.fire("TouchManager:LeftScreenMove",o):o.id==this.rotationTouchID&&this.app.fire("TouchManager:RightScreenMove",o)}},TouchManager.prototype.onTouchEnd=function(t){var e=t.touches;if(e||(e=[t]),e.length>0)for(i=0;i<e.length;i++){var o=e[i];o.id==this.movementTouchID?(this.rotationTouchID=-1,this.app.fire("TouchManager:RightScreenEnd")):o.id==this.rotationTouchID&&(this.movementTouchID=-1,this.app.fire("TouchManager:LeftScreenEnd"))}else this.app.fire("TouchManager:LeftScreenEnd"),this.app.fire("TouchManager:RightScreenEnd"),this.movementTouchID=-1,this.rotationTouchID=-1};var BanditIsland=pc.createScript("banditIsland");BanditIsland.attributes.add("characterEntity",{type:"entity"}),BanditIsland.attributes.add("playerEntity",{type:"entity"}),BanditIsland.attributes.add("banditManager",{type:"entity"}),BanditIsland.prototype.postInitialize=function(){this.currentBandit=!1,this.characterEntity.enabled=!1,pc.currentBanditEntity=!1,this.spawnCharacter(),this.entity.on("Interaction",this.onInteraction,this),this.app.on("BanditIsland:Buy",this.onBanditBuy,this)},BanditIsland.prototype.onBanditBuy=function(){pc.currentBanditEntity.characterEntity.enabled=!1,pc.currentBanditEntity.entity.script.interaction.enabled=!1},BanditIsland.prototype.onInteraction=function(){this.currentBandit&&(this.app.fire("BanditManager:Set",this.currentBandit),pc.currentBanditEntity=this)},BanditIsland.prototype.spawnCharacter=function(){var t=this.banditManager.script.banditManager.getBandit();t&&(this.characterEntity.enabled=!0,this.characterEntity.findByTag("Style").forEach((function(t){t.enabled=!1})),this.characterEntity.findByName(t.body).enabled=!0,this.characterEntity.findByName(t.hat).enabled=!0,this.currentBandit=t)},BanditIsland.prototype.update=function(t){};var Testing=pc.createScript("testing");Testing.attributes.add("version",{type:"string",default:"balance_testing"}),Testing.attributes.add("delay",{type:"number",default:30}),Testing.attributes.add("groups",{type:"entity",array:!0}),Testing.attributes.add("active",{type:"boolean",default:!0}),Testing.prototype.initialize=function(){if(!this.active)return!1;this.userId=Utils.getItemAsString("UserId",Utils.generateUserId()),this.isReturning=!Utils.setOnce("Returning");var t=!1,e=Utils.getItem("TestGroup");if(e?t=this.groups.find((function(t){return t.name.split("-")[1]==e})):(t=Utils.getRandom(this.groups),Utils.setItem("TestGroup",t.name.split("-")[1])),!t)return console.log("No grup exists!"),!1;this.testGroup=t.name.split("-")[1];for(var i=0;i<this.groups.length;i++)this.groups[i].enabled=!1;t.enabled=!0,setInterval((function(t){t.addTime()}),1e3*this.delay,this),this.app.on("PokiSDK:RewardedBreak",this.onReward,this),this.app.on("PokiSDK:CommercialBreak",this.onCommercial,this)},Testing.prototype.addTime=function(){Utils.service("?request=add_time",{is_returning:this.isReturning,user_id:this.userId,test_group:this.testGroup,version:this.version},(function(t){console.log("Adding time succesful!")}))},Testing.prototype.onReward=function(){Utils.service("?request=add_reward_break",{is_returning:this.isReturning,user_id:this.userId,test_group:this.testGroup,version:this.version},(function(t){console.log("Adding reward break succesful!")}))},Testing.prototype.onCommercial=function(){Utils.service("?request=add_commercial_break",{is_returning:this.isReturning,user_id:this.userId,test_group:this.testGroup,version:this.version},(function(t){console.log("Adding reward break succesful!")}))};var AttentionIcon=pc.createScript("attentionIcon");AttentionIcon.attributes.add("icon",{type:"asset"});var PopupPrevent=pc.createScript("popupPrevent");PopupPrevent.prototype.initialize=function(){this.entity.element.on("mouseup",this.onPress,this)},PopupPrevent.prototype.onPress=function(t){t._stopPropagation=!0};var AttentionLoop=pc.createScript("attentionLoop");AttentionLoop.attributes.add("attentionIcon",{type:"entity"}),AttentionLoop.attributes.add("offset",{type:"vec3",default:[0,1,0]}),AttentionLoop.attributes.add("distance",{type:"number",default:15}),AttentionLoop.prototype.initialize=function(){this.attentionEntities=this.app.root.findByTag("Attention")},AttentionLoop.prototype.update=function(){this.checkClosest()},AttentionLoop.prototype.checkClosest=function(){for(var t=this.distance,n=null,i=this.attentionEntities.length;i--;){var e=this.entity.getPosition().distance(this.attentionEntities[i].getPosition());e<t&&(t=e,n=this.attentionEntities[i])}n&&this.lastShown!=n&&(this.attentionIcon.element.textureAsset=n.script.attentionIcon.icon,this.app.fire("World2Screen:Show","Attention",n,this.offset,2),this.lastShown=n)};Object.assign(pc,function(){var BlackWhiteEffect=function(t){pc.PostEffect.call(this,t);var e={aPosition:pc.SEMANTIC_POSITION},i=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),c=["precision "+t.precision+" float;","","uniform sampler2D uColorBuffer;","varying vec2 vUv0;","","void main() {","    vec4 color = texture2D(uColorBuffer, vUv0);","    float gray = dot(color.rgb, vec3(0.199, 0.587, 0.114));","    gl_FragColor = vec4(vec3(gray), 1.0);","}"].join("\n");this.blackWhiteShader=new pc.Shader(t,{attributes:e,vshader:i,fshader:c})};return(BlackWhiteEffect.prototype=Object.create(pc.PostEffect.prototype)).constructor=BlackWhiteEffect,Object.assign(BlackWhiteEffect.prototype,{render:function(t,e,i){var c=this.device;c.scope.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(c,e,this.vertexBuffer,this.blackWhiteShader,i)}}),{BlackWhiteEffect:BlackWhiteEffect}}());var BlackWhite=pc.createScript("blackWhite");BlackWhite.prototype.initialize=function(){this.effect=new pc.BlackWhiteEffect(this.app.graphicsDevice),this.effect.offset=this.offset,this.effect.darkness=this.darkness,this.on("attr",(function(t,e){this.effect[t]=e}),this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};var Slider=pc.createScript("slider");Slider.attributes.add("valueEntity",{type:"entity"}),Slider.attributes.add("sizeEntity",{type:"entity"}),Slider.prototype.initialize=function(){this.on("state",this.onUpdate,this),this.entity.scrollbar.on("set:value",this.onUpdate,this),this.onUpdate()},Slider.prototype.onUpdate=function(t){this.valueEntity.element.text=Math.round(100*this.entity.scrollbar.value)+"%",this.sizeEntity.setLocalScale(this.entity.scrollbar.value,1,1)};!function(){const e=function getIosVersion(){if(/iP(hone|od|ad)/.test(navigator.platform)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||0,10)]}return null}();document.documentElement.style.setProperty("--sat","env(safe-area-inset-top)"),document.documentElement.style.setProperty("--sab","env(safe-area-inset-bottom)"),document.documentElement.style.setProperty("--sal","env(safe-area-inset-left)"),document.documentElement.style.setProperty("--sar","env(safe-area-inset-right)");const t=pc.Application.getApplication();let n=null;function createInputDom(){n&&n.remove(),n=document.createElement("input"),n.setAttribute("type","text"),n.style.position="absolute",n.style.fontFamily="Arial, sans-serif",n.style.background="white",n.style.paddingLeft="10px",n.style.paddingRight="10px",n.style.margin="0px",n.style.visibility="hidden",n.style.zIndex=1e3,resetStyle(),n.value="",document.body.appendChild(n)}createInputDom();let o=!1,i=!1,l=null;function onInputFieldClick(e,t){t.stopPropagation(),showDom(e,t)}function showDom(e,t){if(i!==e){switch(i&&i!==e&&onBlur(),i=e,"visible"!==n.style.visibility&&(t.changedTouches?(t.event.preventDefault(),o=!1):o=!0,n.style.visibility="visible",n.onblur=onBlur,n.addEventListener("keydown",onKeyDown),n.addEventListener("keyup",onKeyUp)),n.value=e.value,n.maxLength=e.maxLength,n.placeholder=e.placeHolder,n.pattern=null,n.spellcheck=!1,e.inputType){case"text":default:n.type="text",n.spellcheck=!0;break;case"text no spellcheck":n.type="text";break;case"number":n.type="number",n.pattern="[0-9]*";break;case"decimal":n.type="number";break;case"email":n.type="email";break;case"password":n.type="password"}n.enterKeyHint=e.enterKeyHint,n.focus(),updateStyle(),i.entity.element.on("resize",updateStyle)}}function onBlur(){n.onblur=null,n.removeEventListener("keydown",onKeyDown),n.removeEventListener("keyup",onKeyUp),n.style.visibility="hidden",function onElementSwitch(){i.entity.fire("uiinput:updatevalue",n.value),i.entity.element.off("resize",updateStyle),"password"===i.inputType&&createInputDom(),i=null}()}function onKeyDown(e){e.stopPropagation(),13===e.keyCode&&n.blur()}function onKeyUp(e){e.preventDefault(),e.stopPropagation()}function resetStyle(){const e=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sal")),t=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sar"));n.style.left="20px",n.style.height="40px",n.style.width=window.innerWidth-64-e-t+"px",n.style.fontSize="100%",n.style.top="20px",n.style.marginTop="env(safe-area-inset-top)",n.style.marginLeft="env(safe-area-inset-left)",n.style.bottom=null}function updateStyle(){if(i)if(o&&i.entity.element.screenCorners){const e=i.entity.element.screenCorners,o=Math.min(t.graphicsDevice.maxPixelRatio,window.devicePixelRatio);n.style.left=e[0].x/o-2+"px",n.style.bottom=e[0].y/o-2+"px",n.style.top=null;const l=(e[2].x-e[0].x)/o-20,s=(e[2].y-e[0].y)/o;n.style.width=l+"px",n.style.height=s+"px",n.style.fontSize=Math.round(.5*s)+"px"}else resetStyle()}function onIosResizeTimeout(){t.on("uiinput:clicked",onInputFieldClick),l=null}e?l=setTimeout(onIosResizeTimeout,2100):(t.on("uiinput:clicked",onInputFieldClick),t.on("uiinput:focus",showDom)),t.graphicsDevice.on("resizecanvas",(function onResize(){e&&!l&&(t.off("uiinput:clicked",onInputFieldClick),l=setTimeout(onIosResizeTimeout,2100)),setTimeout((()=>{updateStyle()}))}))}();var UiInputField=pc.createScript("uiInputField");UiInputField.attributes.add("textEntity",{type:"entity",title:"Text Entity",description:"The Entity that has the text Element to update with the inputted text."}),UiInputField.attributes.add("inputType",{type:"string",title:"Input Type",description:"What type of input will this field accept. On some devices, the virtual keyboard layout may change as well. For example, 'Number' will bring up a numpad instead of the full keyboard.",default:"text",enum:[{Text:"text"},{"Text (no spellcheck)":"text no spellcheck"},{Email:"email"},{Number:"number"},{Decimal:"decimal"},{Password:"password"}]}),UiInputField.attributes.add("enterKeyHint",{type:"string",title:"Enter Key Hint",description:"Change what the enter key shows on the virutal keyboard. Different OSs will have different representations of the hint.",default:"enter",enum:[{Enter:"enter"},{Done:"done"},{Go:"go"},{Search:"search"},{Send:"send"}]}),UiInputField.attributes.add("maxLength",{type:"number",default:32,title:"Max Length",description:"Maximum length of the text can be."}),UiInputField.attributes.add("placeHolder",{type:"string",default:"Placeholder text...",title:"Place Holder String",description:"When the inputted text is empty, what should show as placeholder? Usually this is a prompt such as 'Enter your email here'."}),UiInputField.attributes.add("placeHolderColor",{type:"rgb",title:"Place Holder Text Color",description:"What color the text should be when the placeholder string is used."}),UiInputField.prototype.initialize=function(){this._textElement=this.textEntity.element,this._textColor=this._textElement.color.clone(),this.value="",this.setEvents("on"),this.on("destroy",(()=>{this.setEvents("off")})),this._onValueChange("")},UiInputField.prototype.setEvents=function(t){this.entity[t]("uiinput:updatevalue",this._onValueChange,this),this.entity.element[t]("click",this._onClick,this),this.entity[t]("focus",this.onFocus,this)},UiInputField.prototype.onFocus=function(){this.app.fire("uiinput:focus",this,{})},UiInputField.prototype._onValueChange=function(t){if(this.value=t,t.length>0){if("password"===this.inputType){let e="";for(let i=0;i<t.length;++i)e+="*";this._textElement.text=e}else this._textElement.text=t;this._textElement.color=this._textColor}else this._textElement.text=this.placeHolder,this._textElement.color=this.placeHolderColor;this.entity.fire("updatedvalue",t)},UiInputField.prototype._onClick=function(t){this.app.fire("uiinput:clicked",this,t)};var RewardManager=pc.createScript("rewardManager");RewardManager.attributes.add("points",{type:"entity",array:!0}),RewardManager.attributes.add("rewards",{type:"entity",array:!0}),RewardManager.attributes.add("cooldown",{type:"number",default:80}),RewardManager.attributes.add("activeTime",{type:"number",default:120}),RewardManager.attributes.add("rewardCount",{type:"entity"}),RewardManager.attributes.add("rewardCountBar",{type:"entity"}),RewardManager.attributes.add("rewardClock",{type:"entity"}),RewardManager.prototype.initialize=function(){this.reward=!1,this.rewardTimerActive=!1,this.rewardTimer=Date.now(),this.watchedAds=0,this.amountOfAds=3,this.randomRewardPoint,this.app.on("RewardManager:Buy",this.unlockRewardItem,this),this.app.on("UpgradeManager:RemoveReward",this.stopRewardTimer,this)},RewardManager.prototype.onCreateReward=function(){if(1==this.reward.enabled)return!1;this.createRewardOnMap()},RewardManager.prototype.createRewardOnMap=function(e){for(var a=0;a<this.rewards.length;a++)this.reward=this.rewards[a].clone();this.rewardTimerActive=!0,this.randomRewardPoint=Math.floor(Math.random()*this.points.length),this.points[this.randomRewardPoint].addChild(this.reward),this.reward.enabled=!0,this.points[this.randomRewardPoint].enabled=!0,this.points[this.randomRewardPoint].collision.enabled=!0,this.points[this.randomRewardPoint].fire("Minimap:ShowIcon")},RewardManager.prototype.removeRewardFromMap=function(e){this.points[this.randomRewardPoint].fire("Minimap:HideIcon"),this.reward.enabled=!1,this.points[this.randomRewardPoint].removeChild(this.reward),this.points[this.randomRewardPoint].enabled=!1,this.points[this.randomRewardPoint].collision.enabled=!1},RewardManager.prototype.unlockRewardItem=function(){var e=this;PokiPlugin.showReward((function(a){a?(e.watchedAds+=1,e.watchedAds>=e.amountOfAds&&(e.watchedAds=0,e.removeRewardFromMap(),e.startRewardTimer(),e.app.fire("UpgradeManager:Reward"),e.app.fire("PopupManager:Hide")),e.updateAmountOfWatchedAds()):pc.app.fire("Overlay:Alert","You need to disable adblock!")}))},RewardManager.prototype.startRewardTimer=function(){this.rewardClock.enabled=!0,this.rewardClock.script.time.time=this.activeTime},RewardManager.prototype.stopRewardTimer=function(){this.rewardClock.enabled=!1,this.rewardTimerActive=!1,this.rewardTimer=Date.now()},RewardManager.prototype.updateAmountOfWatchedAds=function(){this.rewardCount.element.text=this.watchedAds+" / "+this.amountOfAds,this.rewardCountBar.findByName("Fill").script.timeline.endFrame.scale.x=this.watchedAds/this.amountOfAds,this.rewardCountBar.findByName("Fill").fire("Timeline")},RewardManager.prototype.update=function(e){!this.rewardTimerActive&&Date.now()-this.rewardTimer>1e3*this.cooldown&&this.onCreateReward()};var Screenshot=pc.createScript("screenshot");Screenshot.attributes.add("cameraEntity",{type:"entity",description:"The camera entity to use for taking the screenshot with. Whatever, this camera renders will be in the screen capture."}),Screenshot.prototype.initialize=function(){this.createNewRenderTexture(),this.app.graphicsDevice.on("resizecanvas",(function(e,t){this.secsSinceSameSize=0}),this);var e=this.app.graphicsDevice;this.lastWidth=e.width,this.lastHeight=e.height,this.secsSinceSameSize=0,this.triggerScreenshot=!1;var onTakeScreenshot=function(){this.triggerScreenshot=!0,this.cameraEntity.enabled=!0};this.app.on("ui:takeScreenshot",onTakeScreenshot,this),this.app.on("postrender",this.postRender,this),this.cameraEntity.enabled=!1,this.cameraEntity.camera.priority=-1;var t=document.createElement("a");t.id="link",window.document.body.appendChild(t),this.on("destroy",(function(){this.app.off("ui:takeScreenshot",onTakeScreenshot,this),this.app.off("postrender",this.postRender,this),window.document.body.removeChild(t),this.renderTarget&&(this.renderTarget.destroy(),this.renderTarget=null),this.colorTexture&&(this.colorTexture.destroy(),this.colorTexture=null),this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null),this.canvas=null,this.context=null}),this)},Screenshot.prototype.update=function(e){this.app.keyboard.wasPressed(pc.KEY_X)&&this.app.fire("ui:takeScreenshot");var t=this.app.graphicsDevice;t.width==this.lastWidth&&t.height==this.lastHeight&&(this.secsSinceSameSize+=e),this.secsSinceSameSize>.25&&(this.unScaledTextureWidth==t.width&&this.unScaledTextureHeight==t.height||this.createNewRenderTexture()),this.lastWidth=t.width,this.lastHeight=t.height},Screenshot.prototype.postRender=function(){this.triggerScreenshot&&(this.takeScreenshot("screenshot"),this.triggerScreenshot=!1,this.cameraEntity.enabled=!1)},Screenshot.prototype.createNewRenderTexture=function(){var e=this.app.graphicsDevice;if(this.colorTexture&&this.depthTexture&&this.renderTarget){var t=this.renderTarget,i=this.colorTexture,r=this.depthTexture;this.renderTarget=null,this.colorTexture=null,this.depthTexture=null,t.destroy(),i.destroy(),r.destroy()}var h=new pc.Texture(e,{width:e.width,height:e.height,format:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!0}),s=new pc.Texture(e,{format:pc.PIXELFORMAT_DEPTHSTENCIL,width:e.width,height:e.height,mipmaps:!1,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE});h.minFilter=pc.FILTER_LINEAR,h.magFilter=pc.FILTER_LINEAR;var a=new pc.RenderTarget({colorBuffer:h,depthBuffer:s,samples:4});this.cameraEntity.camera.renderTarget=a,this.unScaledTextureWidth=e.width,this.unScaledTextureHeight=e.height,this.colorTexture=h,this.depthTexture=s,this.renderTarget=a;var n=this.renderTarget.colorBuffer;this.canvas||(this.canvas=window.document.createElement("canvas"),this.context=this.canvas.getContext("2d")),this.canvas.width=n.width,this.canvas.height=n.height,this.context.globalCompositeOperation="copy",this.context.setTransform(1,0,0,1,0,0),this.context.scale(1,-1),this.context.translate(0,-this.canvas.height),this.pixels=new Uint8Array(h.width*h.height*4)},Screenshot.prototype.takeScreenshot=function(e){var t=this.renderTarget.colorBuffer,i=this.renderTarget.depthBuffer;this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,t.width,t.height),this.context.restore();var r=this.app.graphicsDevice.gl,h=this.app.graphicsDevice.gl.createFramebuffer(),s=this.pixels,a=t.impl?t.impl._glTexture:t._glTexture,n=i.impl?i.impl._glTexture:i._glTexture;r.bindFramebuffer(r.FRAMEBUFFER,h),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,n,0),r.readPixels(0,0,t.width,t.height,r.RGBA,r.UNSIGNED_BYTE,s),r.deleteFramebuffer(h);this.context.createImageData(t.width,t.height).data;var c=this.context.getImageData(0,0,t.width,t.height);c.data.set(new Uint8ClampedArray(s)),this.context.putImageData(c,0,0),this.context.drawImage(this.canvas,0,0);this.canvas.toDataURL("image/png");var o=this.canvas.toDataURL("image/png").replace("image/png","image/octet-stream"),d=document.getElementById("link");d.setAttribute("download",e+".png"),d.setAttribute("href",o),d.click()};var Time=pc.createScript("time");Time.attributes.add("start",{type:"number",default:0}),Time.attributes.add("direction",{type:"string",default:"Forward",enum:[{Forward:"Forward"},{Backward:"Backward"}]}),Time.attributes.add("startEvent",{type:"string"}),Time.attributes.add("endEvent",{type:"string"}),Time.prototype.initialize=function(){this.startEventTriggered=!1,this.endEventTriggered=!1,this.time=parseFloat(this.start+""),this.on("state",this.onStateChange,this),this.startEvent&&!this.startEventTriggered&&(this.app.fire(this.startEvent),this.startEventTriggered=!0)},Time.prototype.onStateChange=function(){this.startEventTriggered=!1,this.endEventTriggered=!1,this.time=parseFloat(this.start+"")},Time.prototype.update=function(t){"Forward"==this.direction?this.time+=t:this.time-=t,"Backward"==this.direction&&this.endEvent&&this.time<=0&&!this.endEventTriggered&&(this.app.fire(this.endEvent),this.endEventTriggered=!0),this.entity.element.text=Utils.mmss(this.time)};